<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Nothing | Blog/博客 [个人]</title><meta name="author" content="Ewig-Milan"><meta name="copyright" content="Ewig-Milan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="这是一篇长文">
<meta property="og:type" content="article">
<meta property="og:title" content="Nothing">
<meta property="og:url" content="https://ewig-milan.github.io/2025/07/07/Nothing/index.html">
<meta property="og:site_name" content="Blog&#x2F;博客 [个人]">
<meta property="og:description" content="这是一篇长文">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.sda1.dev/24/5a38ca2b266b9e659804c5758c4d203b/art6.jpg">
<meta property="article:published_time" content="2025-07-06T16:00:00.000Z">
<meta property="article:modified_time" content="2026-02-14T16:00:00.000Z">
<meta property="article:author" content="Ewig-Milan">
<meta property="article:tag" content="All">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.sda1.dev/24/5a38ca2b266b9e659804c5758c4d203b/art6.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Nothing",
  "url": "https://ewig-milan.github.io/2025/07/07/Nothing/",
  "image": "https://p.sda1.dev/24/5a38ca2b266b9e659804c5758c4d203b/art6.jpg",
  "datePublished": "2025-07-06T16:00:00.000Z",
  "dateModified": "2026-02-14T16:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Ewig-Milan",
      "url": "https://github.com/Ewig-Milan"
    }
  ]
}</script><link rel="shortcut icon" href="https://p.sda1.dev/24/36897a4a44c94c465d1ffd755b6a54ff/f9e4d666-1643-4a81-9c41-1d193ad0e9bd.png"><link rel="canonical" href="https://ewig-milan.github.io/2025/07/07/Nothing/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":800,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Nothing',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.css" integrity="sha384-bsHo4/LA+lkZv61JspMDQB9QP1TtO4IgOf2yYS+J6VdAYLVyx1c3XKcsHh0Vy8Ws" crossorigin="anonymous"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin="anonymous" referrerpolicy="no-referrer" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(https://p.sda1.dev/24/9cf752c2dd62b0236dc2ec329e55b596/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://p.sda1.dev/24/9cac71e50a28808a469a781a6868ef07/280px-Bad_Cen.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 回顾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://p.sda1.dev/24/5a38ca2b266b9e659804c5758c4d203b/art6.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://p.sda1.dev/24/36897a4a44c94c465d1ffd755b6a54ff/f9e4d666-1643-4a81-9c41-1d193ad0e9bd.png" alt="Logo"><span class="site-name">Blog/博客 [个人]</span></a><a class="nav-page-title" href="/"><span class="site-name">Nothing</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 回顾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Nothing</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-06T16:00:00.000Z" title="发表于 2025-07-07 00:00:00">2025-07-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-14T16:00:00.000Z" title="更新于 2026-02-15 00:00:00">2026-02-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AA%E4%BA%BA%E6%A8%A1%E6%9D%BF/">个人模板</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="附言"><a href="#附言" class="headerlink" title="附言"></a>附言</h1><p>涉及到的一切代码碎片都可以溯源于<a target="_blank" rel="noopener" href="https://github.com/Ewig-Milan/Online-Code"><strong>这个仓库</strong></a>。</p>
<h1 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h1><p>对于一位复习者而言，重要的不是把代码重写一遍（数据结构除外），我们需要的是把早已淡忘的算法<strong>思路</strong>再理一遍，而不仅是对着自己的代码模板看，这也是我引用如此多外部资料的原因<del>自己写不出来</del>。  </p>
<p>但是，在涉及数学计算时，再怎么“详”的解析我们可能都会看得一知半解，一个现实但搞笑的原因是——<strong>对方用的变量名我们自己不习惯</strong>，往往看着看着就突然大脑空白，干瞪眼——因为你没法第一时间反应过来这些字母什么意思。  </p>
<p>然而，式子本身的理解就难，我们还需要时刻记着“这个字母表示…”，那简直是折磨 CPU。所以这类知识需要自己上手写一遍，做到：当你回头看前面的式子，像看汉语一般即刻反应过来：“那一步我是在…”。  </p>
<p>如此复习，还能在提高效率的同时巩固自己的“风格”，一旦当拥有了恒定的风格，不论是数学格式还是代码码风，都能让你在后续回顾的过程中有一个很好的学习体验（就像这篇文章，好些我自己 1 年前的代码都能直接拿来用）。</p>
<p>所以，精神层面“知识是自己的”固然重要，但在现实（物质）层面“把知识变成自己的”益处也很大，这便也是这篇文章诞生的原因。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id="数学"><a href="#数学" class="headerlink" title="数学"></a>数学</h1><h2 id="数论"><a href="#数论" class="headerlink" title="数论"></a>数论</h2><h3 id="Bases"><a href="#Bases" class="headerlink" title="Bases"></a>Bases</h3><ul>
<li><strong>GCD &amp; LCM</strong>（最大公因数 &amp; 最小公倍数）。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!b) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">gcd</span>(b, a % b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lcm</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;<span class="keyword">return</span> a / <span class="built_in">gcd</span>(a, b) * b;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>快速幂。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">quick_p</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> a, <span class="type">int</span> mod)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(a) &#123;</span><br><span class="line">        <span class="keyword">if</span>(a &amp; <span class="number">1</span>) res *= x, res %= mod;</span><br><span class="line">        x *= x, x %= mod, a &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="线性筛"><a href="#线性筛" class="headerlink" title="线性筛"></a>线性筛</h3><ul>
<li>线性时间 筛 <strong>质数</strong>、<strong>欧拉函数</strong>、<strong>莫比乌斯函数</strong>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> pr[N], cnt, phi[N], mu[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">euler</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>, phi[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!phi[i]) pr[++cnt] = i, phi[i] = i - <span class="number">1</span>, mu[i] = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; pr[j] * i &lt;= n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i % pr[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                phi[i * pr[j]] = phi[i] * pr[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * pr[j]] = -mu[i];</span><br><span class="line">            phi[i * pr[j]] = phi[i] * phi[pr[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="逆元-EXGCD"><a href="#逆元-EXGCD" class="headerlink" title="逆元 &amp; EXGCD"></a>逆元 &amp; EXGCD</h3><ul>
<li>扩展欧几里得求 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>⋅</mo><msup><mi>a</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.4444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a\cdot a^{-1} \equiv 1\pmod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.4444em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.3333em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span>、即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msup><mi>a</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="false">)</mo><mo>+</mo><mi>p</mi><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">ax(a^{-1})+py=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!b) &#123;</span><br><span class="line">        x = <span class="number">1</span>, y = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> g = <span class="built_in">exgcd</span>(b, a % b, y, x);</span><br><span class="line">    y -= a / b * x;</span><br><span class="line">    <span class="keyword">return</span> g;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>费马小定理有，对于质数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>⋅</mo><msup><mi>a</mi><mrow><mi>p</mi><mo>−</mo><mn>2</mn></mrow></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.4444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a\cdot a^{p-2}\equiv 1 \pmod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.4444em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.3333em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span>，快速幂求 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mrow><mi>p</mi><mo>−</mo><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">a^{p-2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">inv</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> p)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">quick_p</span>(x, p - <span class="number">2</span>, p);&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>线性时间递推，基于 <a target="_blank" rel="noopener" href="https://blog.csdn.net/roadtohacker/article/details/114649741"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>inv</mtext><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mo>−</mo><mo stretchy="false">⌊</mo><mfrac><mi>p</mi><mi>i</mi></mfrac><mo stretchy="false">⌋</mo><mo>×</mo><mtext>inv</mtext><mo stretchy="false">[</mo><mi>p</mi><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{inv}[i]=-\lfloor\frac pi\rfloor \times \text{inv}[p\bmod i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">inv</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.095em;vertical-align:-0.345em;"></span><span class="mord">−</span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7475em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">⌋</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">inv</span></span><span class="mopen">[</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span></a>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> inv[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_inv</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    inv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">        inv[i] = (<span class="type">long</span> <span class="type">long</span>)(mod - mod / i) * inv[mod % i] % mod;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>阶乘逆元的递推，基于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mrow><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo></mrow></mfrac><mo>×</mo><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mi>n</mi><mo stretchy="false">!</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac 1{(n+1)!}\times(n+1)=\frac 1{n!}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3651em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)!</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mclose mtight">!</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>inv</mtext><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mi>i</mi><mi>n</mi><mi>v</mi><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo>×</mo><mo stretchy="false">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{inv}[i]=inv[i+1]\times(i+1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">inv</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> fac[N], inv[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_fac_inv</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    fac[<span class="number">0</span>] = <span class="number">1</span>, inv[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) fac[i] = (<span class="type">long</span> <span class="type">long</span>)fac[i - <span class="number">1</span>] * i % mod;</span><br><span class="line">    inv[n] = <span class="built_in">get_inv</span>(fac[n]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = n - <span class="number">1</span>; i &gt; <span class="number">1</span>; i--) inv[i] = (<span class="type">long</span> <span class="type">long</span>)inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % mod;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="欧拉函数"><a href="#欧拉函数" class="headerlink" title="欧拉函数"></a><a target="_blank" rel="noopener" href="https://oi-wiki.org/math/number-theory/euler-totient/">欧拉函数</a></h3><ul>
<li>质因数分解。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">phi</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> res = x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i * i &lt;= x; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(x % i == <span class="number">0</span>) res = res / i * (i - <span class="number">1</span>); </span><br><span class="line">        <span class="keyword">while</span>(x % i == <span class="number">0</span>) x /= i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x &gt; <span class="number">1</span>) res = res / x * (x - <span class="number">1</span>); </span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<ul>
<li><p>线性筛。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://oi-wiki.org/math/number-theory/fermat/#%E6%AC%A7%E6%8B%89%E5%AE%9A%E7%90%86">欧拉定理</a>有，若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>p</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\gcd(a,p)=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.4444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a^{\varphi(p)}\equiv 1 \pmod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">φ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.4444em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.3333em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://oi-wiki.org/math/number-theory/fermat/#%E6%89%A9%E5%B1%95%E6%AC%A7%E6%8B%89%E5%AE%9A%E7%90%86">扩展欧拉定理</a>，<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4139">欧拉降幂</a>。</p>
</li>
</ul>
<hr>
<h3 id="（整除）数论分块"><a href="#（整除）数论分块" class="headerlink" title="（整除）数论分块"></a>（整除）数论分块</h3><ul>
<li>求 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mi>g</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>f</mi><mo stretchy="false">(</mo><mo stretchy="false">⌊</mo><mfrac><mi>n</mi><mi>i</mi></mfrac><mo stretchy="false">⌋</mo><mi mathvariant="normal">/</mi><mo stretchy="false">⌈</mo><mfrac><mi>n</mi><mi>i</mi></mfrac><mo stretchy="false">⌉</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sum_{i=1}^{n}g(i)\cdot f(\lfloor\frac ni\rfloor/\lceil\frac ni\rceil)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.104em;vertical-align:-0.2997em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.095em;vertical-align:-0.345em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6954em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">⌋</span><span class="mord">/</span><span class="mopen">⌈</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6954em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">⌉)</span></span></span></span>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">    r = n / (n / l), ans += (gsum[r] - gsum[l - <span class="number">1</span>]) * <span class="built_in">f</span>(n / l);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> l = <span class="number">1</span>, r; l &lt; n; l = r + <span class="number">1</span>)</span><br><span class="line">    r = (n - <span class="number">1</span>) / ((n - <span class="number">1</span>) / l), ans += (gsum[r] - gsum[l - <span class="number">1</span>]) * <span class="built_in">f</span>(n / l + <span class="number">1</span>);</span><br><span class="line">ans += <span class="built_in">f</span>(<span class="number">1</span>) * <span class="built_in">g</span>(n);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="CRT-EXCRT"><a href="#CRT-EXCRT" class="headerlink" title="CRT &amp; EXCRT"></a>CRT &amp; EXCRT</h3><blockquote>
<p>这一部分手推一遍可以更好地理解</p>
</blockquote>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://oi-wiki.org/math/number-theory/crt/">CRT</a>，<strong>exLucas</strong> 的前提。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/article/lr8vtpzl">EXCRT</a>。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> rmd[N], p[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">excrt</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> P = p[<span class="number">1</span>], RMD = rmd[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> Y, y;</span><br><span class="line">        <span class="type">int</span> g = <span class="built_in">exgcd</span>(P, p[i], Y, y);</span><br><span class="line">        <span class="keyword">if</span>((rmd[i] - RMD) % g) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        RMD += P / g * Y * (rmd[i] - RMD);</span><br><span class="line">        P = P / g * p[i];</span><br><span class="line">        RMD = (RMD % P + P) % P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> RMD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="莫比乌斯反演"><a href="#莫比乌斯反演" class="headerlink" title="莫比乌斯反演"></a>莫比乌斯反演</h3><ul>
<li>简单看一个式子 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>x</mi><mo>=</mo><mo>=</mo><mn>1</mn><mo stretchy="false">]</mo><mo>=</mo><mi>ε</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mo>∑</mo><mrow><mi>d</mi><mo>∣</mo><mi>x</mi></mrow></msub><mi>μ</mi><mo stretchy="false">(</mo><mi>d</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">[x==1]=\varepsilon(x)=\sum_{d\mid x}\mu(d)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">==</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ε</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2247em;vertical-align:-0.4747em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2253em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mrel mtight">∣</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4747em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">μ</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mclose">)</span></span></span></span>，能接触到的简单莫比乌斯反演题都能用上。</li>
</ul>
<hr>
<h3 id="欧拉反演"><a href="#欧拉反演" class="headerlink" title="欧拉反演"></a>欧拉反演</h3><ul>
<li>简单看一个式子 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><msub><mo>∑</mo><mrow><mi>d</mi><mo>∣</mo><mi>n</mi></mrow></msub><mi>φ</mi><mo stretchy="false">(</mo><mi>d</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">n=\sum_{d\mid n}\varphi(d)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2247em;vertical-align:-0.4747em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2253em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mrel mtight">∣</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4747em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mclose">)</span></span></span></span>，不会推的式子可以尝试带一下欧拉反演。</li>
</ul>
<hr>
<p>&nbsp;</p>
<h2 id="组合数学"><a href="#组合数学" class="headerlink" title="组合数学"></a>组合数学</h2><h3 id="Bases-1"><a href="#Bases-1" class="headerlink" title="Bases"></a>Bases</h3><ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>A</mi><mi>n</mi><mi>m</mi></msubsup><mo>=</mo><mfrac><mrow><mi>n</mi><mo stretchy="false">!</mo></mrow><mrow><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mi>m</mi><mo stretchy="false">)</mo><mo stretchy="false">!</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">A^m_n=\frac{n!}{(n-m)!}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9303em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4001em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">m</span><span class="mclose mtight">)!</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mclose mtight">!</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>C</mi><mi>n</mi><mi>m</mi></msubsup><mo>=</mo><mfrac><mrow><mi>n</mi><mo stretchy="false">!</mo></mrow><mrow><mi>m</mi><mo stretchy="false">!</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mi>m</mi><mo stretchy="false">)</mo><mo stretchy="false">!</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">C_n^m=\frac{n!}{m!(n-m)!}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9303em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4001em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mclose mtight">!</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">m</span><span class="mclose mtight">)!</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mclose mtight">!</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。
</li>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/559453837"><strong>Else</strong></a>。</p>
</li>
</ul>
<hr>
<h3 id="容斥原理"><a href="#容斥原理" class="headerlink" title="容斥原理"></a>容斥原理</h3><ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">∣</mo><msubsup><mo>⋃</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>A</mi><mi>i</mi></msub><mo fence="true">∣</mo></mrow><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msup><msub><mo>∑</mo><mrow><mn>1</mn><mo>≤</mo><msub><mi>i</mi><mn>1</mn></msub><mo>&lt;</mo><msub><mi>i</mi><mn>2</mn></msub><mo>&lt;</mo><mo>⋯</mo><mo>&lt;</mo><msub><mi>i</mi><mi>k</mi></msub><mo>≤</mo><mi>n</mi></mrow></msub><mrow><mo fence="true">∣</mo><msub><mi>A</mi><msub><mi>i</mi><mn>1</mn></msub></msub><mo>∩</mo><msub><mi>A</mi><msub><mi>i</mi><mn>2</mn></msub></msub><mo>∩</mo><mo>⋯</mo><mo>∩</mo><msub><mi>A</mi><msub><mi>i</mi><mi>k</mi></msub></msub><mo fence="true">∣</mo></mrow></mrow><annotation encoding="application/x-tex">\left| \bigcup_{i=1}^n A_i \right| = \sum_{k=1}^n (-1)^{k-1} \sum_{1 \leq i_1 &lt; i_2 &lt; \cdots &lt; i_k \leq n} \left| A_{i_1} \cap A_{i_2} \cap \cdots \cap A_{i_k} \right|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.104em;vertical-align:-0.2997em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">∣</span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋃</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">∣</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2547em;vertical-align:-0.4056em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mrel mtight">≤</span><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">&lt;</span><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">&lt;</span><span class="minner mtight">⋯</span><span class="mrel mtight">&lt;</span><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span><span class="mrel mtight">≤</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4056em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">∣</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2559em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">∣</span></span></span></span></span>。
</li>
<li><p><a target="_blank" rel="noopener" href="https://oi-wiki.org/math/combinatorics/inclusion-exclusion-principle/">扩展</a>。</p>
</li>
</ul>
<hr>
<h3 id="二项式定理"><a href="#二项式定理" class="headerlink" title="二项式定理"></a>二项式定理</h3><ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>y</mi><msup><mo stretchy="false">)</mo><mi>n</mi></msup><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></msubsup><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mi>n</mi><mi>k</mi></mfrac><mo fence="true">)</mo></mrow><msup><mi>x</mi><mrow><mi>n</mi><mo>−</mo><mi>k</mi></mrow></msup><msup><mi>y</mi><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">(x + y)^n = \sum_{k=0}^{n} \binom{n}{k} x^{n-k} y^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7454em;"><span style="top:-2.355em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.144em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span>。</li>
</ul>
<hr>
<h3 id="Lucas-定理"><a href="#Lucas-定理" class="headerlink" title="Lucas 定理"></a><a target="_blank" rel="noopener" href="https://oi-wiki.org/math/number-theory/lucas/#lucas-%E5%AE%9A%E7%90%86">Lucas 定理</a></h3><ul>
<li>对于质数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mi>n</mi><mi>k</mi></mfrac><mo fence="true">)</mo></mrow><mo>≡</mo><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><mo fence="true">⌊</mo><mi>n</mi><mi mathvariant="normal">/</mi><mi>p</mi><mo fence="true">⌋</mo></mrow><mrow><mo fence="true">⌊</mo><mi>k</mi><mi mathvariant="normal">/</mi><mi>p</mi><mo fence="true">⌋</mo></mrow></mfrac><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><mi>n</mi><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>p</mi></mrow><mrow><mi>k</mi><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>p</mi></mrow></mfrac><mo fence="true">)</mo></mrow><mspace></mspace><mspace width="0.4444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\binom{n}{k} \equiv \binom{\left\lfloor n/p \right\rfloor}{\left\lfloor k/p \right\rfloor} \binom{n \bmod p}{k \bmod p} \pmod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7454em;"><span style="top:-2.355em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.144em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.52em;vertical-align:-0.5355em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9845em;"><span style="top:-2.3395em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">⌊</span></span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mord mtight">/</span><span class="mord mathnormal mtight">p</span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">⌋</span></span></span></span></span></span><span style="top:-3.1595em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">⌊</span></span><span class="mord mathnormal mtight">n</span><span class="mord mtight">/</span><span class="mord mathnormal mtight">p</span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">⌋</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5355em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9301em;"><span style="top:-2.355em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mspace mtight" style="margin-right:0.3253em;"></span><span class="mbin mtight"><span class="mord mtight"><span class="mord mathrm mtight">mod</span></span></span><span class="mspace mtight" style="margin-right:0.3253em;"></span><span class="mord mathnormal mtight">p</span></span></span></span><span style="top:-3.144em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mspace mtight" style="margin-right:0.3253em;"></span><span class="mbin mtight"><span class="mord mtight"><span class="mord mathrm mtight">mod</span></span></span><span class="mspace mtight" style="margin-right:0.3253em;"></span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.4444em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.3333em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span>，其中，当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&lt;</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">n&lt;k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 时，二项式系数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mi>n</mi><mi>k</mi></mfrac><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\binom{n}{k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7454em;"><span style="top:-2.355em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.144em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span> 规定为 0。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">C</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!m || m == n) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> m &gt; n ? <span class="number">0</span> : fac[n] * inv[m] % mod * inv[n - m] % mod; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Lucas</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !m ? <span class="number">1</span> : (<span class="built_in">C</span>(n % mod, m % mod) % mod * <span class="built_in">Lucas</span>(n / mod, m / mod) % mod);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="exLucas-算法"><a href="#exLucas-算法" class="headerlink" title="exLucas 算法"></a><a target="_blank" rel="noopener" href="https://oi-wiki.org/math/number-theory/lucas/#exlucas-%E7%AE%97%E6%B3%95">exLucas 算法</a></h3><ul>
<li>不想看第二遍了。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">ll n, m, P, x, y, cnts, ANS;</span><br><span class="line">ll su[N], c[N];</span><br><span class="line"><span class="function">ll <span class="title">fac</span><span class="params">(ll a, ll p, ll mod)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!a) <span class="keyword">return</span> <span class="number">1</span>; </span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i = <span class="number">1</span>; i &lt;= mod; i++) <span class="keyword">if</span>(i % p) ans = ans * i % mod;</span><br><span class="line">    ans = <span class="built_in">quick_p</span>(ans, a / mod, mod);</span><br><span class="line">    <span class="keyword">for</span>(ll i = <span class="number">1</span>; i &lt;= a % mod; i++) <span class="keyword">if</span>(i % p) ans = ans * i % mod;</span><br><span class="line">    <span class="keyword">return</span> ans * <span class="built_in">fac</span>(a / p, p, mod) % mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">C</span><span class="params">(ll a, ll b, ll p, ll mod)</span> </span>&#123; <span class="comment">// a底b上 a &gt; b </span></span><br><span class="line">    <span class="keyword">if</span>(a &lt; b) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    ll cntp = <span class="number">0</span>, t1 = <span class="built_in">fac</span>(a, p, mod), t2 = <span class="built_in">fac</span>(b, p, mod), t3 = <span class="built_in">fac</span>(a - b, p, mod);;</span><br><span class="line">    <span class="keyword">for</span>(ll i = p; i &lt;= a; i *= p) cntp += a / i;</span><br><span class="line">    <span class="keyword">for</span>(ll i = p; i &lt;= b; i *= p) cntp -= b / i;</span><br><span class="line">    <span class="keyword">for</span>(ll i = p; i &lt;= a - b; i *= p) cntp -= (a - b) / i;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">quick_p</span>(p, cntp, mod) * t1 % mod * <span class="built_in">quick_p</span>(t2, mod - mod / p - <span class="number">1</span>, mod) % mod * <span class="built_in">quick_p</span>(t3, mod - mod / p - <span class="number">1</span>, mod) % mod;            </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>, &amp;n, &amp;m, &amp;P);</span><br><span class="line">    ll temp = P;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i * i &lt;= P; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(P % i) <span class="keyword">continue</span>;</span><br><span class="line">        su[++cnts] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(P % i == <span class="number">0</span>) su[cnts] *= i, P /= i;</span><br><span class="line">        c[cnts] = <span class="built_in">C</span>(n, m, i, su[cnts]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(P &gt; <span class="number">1</span>) su[++cnts] = P, c[cnts] = <span class="built_in">C</span>(n, m, P, P);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= cnts; i++) &#123;</span><br><span class="line">        <span class="built_in">exgcd</span>(temp / su[i], su[i]);</span><br><span class="line">        x = (x % su[i] + su[i]) % su[i];</span><br><span class="line">        ANS += c[i] * x * (temp / su[i]) % temp, ANS %= temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, ANS);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="卡特兰数"><a href="#卡特兰数" class="headerlink" title="卡特兰数"></a><a target="_blank" rel="noopener" href="https://oi-wiki.org/math/combinatorics/catalan/">卡特兰数</a></h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/sherry_yue/article/details/88364746">常见情境</a>。</p>
</li>
<li><p>暴力打前几项然后瞪眼，<del>证明留给题解</del>。</p>
</li>
</ul>
<hr>
<p>&nbsp;</p>
<h2 id="概率论"><a href="#概率论" class="headerlink" title="概率论"></a>概率论</h2><h3 id="Bases-2"><a href="#Bases-2" class="headerlink" title="Bases"></a>Bases</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/147214759">期望与方差</a>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43221845/article/details/142713241">二项分布</a>。</p>
</li>
</ul>
<hr>
<h3 id="关于概率-期望-DP"><a href="#关于概率-期望-DP" class="headerlink" title="关于概率&#x2F;期望 DP"></a>关于概率&#x2F;期望 DP</h3><ul>
<li>概率起点为 1，顺推；期望在终点确定，倒推。</li>
</ul>
<hr>
<h3 id="高斯消元"><a href="#高斯消元" class="headerlink" title="高斯消元"></a>高斯消元</h3><ul>
<li>注意 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 的时间复杂度在某些<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF24D">特殊矩阵</a>中可以优化。<blockquote>
<p>代码目前没亲手<a target="_blank" rel="noopener" href="https://blog.csdn.net/justidle/article/details/108794887">写过…</a></p>
</blockquote>
</li>
</ul>
<hr>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><h2 id="基础数据结构"><a href="#基础数据结构" class="headerlink" title="基础数据结构"></a>基础数据结构</h2><h3 id="STL-前缀和-差分"><a href="#STL-前缀和-差分" class="headerlink" title="STL &amp; 前缀和 &amp; 差分"></a>STL &amp; 前缀和 &amp; 差分</h3><ul>
<li>无需多言。</li>
</ul>
<hr>
<h3 id="单调队列"><a href="#单调队列" class="headerlink" title="单调队列"></a>单调队列</h3><ul>
<li>注意存下标。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> d[N], k;</span><br><span class="line">deque&lt;<span class="type">int</span>&gt; q;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>() &amp;&amp; d[q.<span class="built_in">back</span>()] &gt;= d[i]) q.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>() &amp;&amp; i - q.<span class="built_in">front</span>() &gt;= k) q.<span class="built_in">pop_front</span>();</span><br><span class="line">    q.<span class="built_in">push_back</span>(i);</span><br><span class="line">    <span class="comment">// q.front() is minimum</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="并查集"><a href="#并查集" class="headerlink" title="并查集"></a>并查集</h3><ul>
<li>路径压缩。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> fa[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x != fa[x]) fa[x] = <span class="built_in">find</span>(fa[x]);</span><br><span class="line">    <span class="keyword">return</span> fa[x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    a = <span class="built_in">find</span>(a), b = <span class="built_in">find</span>(b), fa[b] = a;</span><br><span class="line">    <span class="keyword">return</span> a != b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ul>
<li>启发式合并，同时具有可持久化的特点（存操作序列即可）。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> fa[N], dep[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">return</span> x == fa[x] ? x : <span class="built_in">find</span>(fa[x]);&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    a = <span class="built_in">find</span>(a), b = <span class="built_in">find</span>(b);</span><br><span class="line">    <span class="keyword">if</span>(a == b) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(dep[a] &lt; dep[b]) <span class="built_in">swap</span>(a, b);</span><br><span class="line">    fa[b] = a, dep[a] += dep[a] == dep[b];</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="分块"><a href="#分块" class="headerlink" title="分块"></a>分块</h3><blockquote>
<p>“这个东西看上去就不好维护，想想分块打暴力吧”</p>
</blockquote>
<ul>
<li>优点在于其思想简洁，容易实现，常数小，暴力美学；难点在于其<a target="_blank" rel="noopener" href="https://oi-wiki.org/ds/decompose/">衍生的算法</a>，分块难题全是人类智慧。</li>
</ul>
<hr>
<h3 id="树状数组"><a href="#树状数组" class="headerlink" title="树状数组"></a>树状数组</h3><ul>
<li>一维，单点修改，区间查询。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> Lb(x) ((x) &amp; -(x))</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Bit_T</span> &#123;</span><br><span class="line">    <span class="type">int</span> sum[N];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> delta)</span> </span>&#123;<span class="keyword">while</span>(x &lt;= n) sum[x] += delta, x += <span class="built_in">Lb</span>(x);&#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">presum</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x) res += sum[x], x -= <span class="built_in">Lb</span>(x);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">presum</span>(r) - <span class="built_in">presum</span>(l - <span class="number">1</span>);&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>二维，单点修改，矩阵查询，本质是对于一维的每一个点做一个树状数组。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Bit_T</span> &#123;</span><br><span class="line">    <span class="type">int</span> sum[N][N];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = x; i &lt;= n; i += <span class="built_in">Lb</span>(i))</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = y; j &lt;= n; j += <span class="built_in">Lb</span>(j))</span><br><span class="line">            sum[i][j] += delta;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">presum</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = x; i; i -= <span class="built_in">Lb</span>(i))</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = y; j; j -= <span class="built_in">Lb</span>(j))</span><br><span class="line">            res += sum[i][j];</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> X, <span class="type">int</span> Y)</span> </span>&#123;</span><br><span class="line">        x--, y--;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">presum</span>(X, Y) - <span class="built_in">presum</span>(X, y) - <span class="built_in">presum</span>(x, Y) + <span class="built_in">presum</span>(x, y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="线段树"><a href="#线段树" class="headerlink" title="线段树"></a>线段树</h3><ul>
<li>有各种标记，下例是乘法与加法标记，<strong>绝对标记优先级最高（能影响到所有其他标记，就如下例中乘法标记对加法标记有影响）</strong>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TR</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span> &#123;<span class="type">int</span> sum, add = <span class="number">0</span>, mul = <span class="number">1</span>;&#125;;</span><br><span class="line">    vector&lt;Node&gt; t;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cl</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;t.<span class="built_in">resize</span>(<span class="number">0</span>); t.<span class="built_in">resize</span>(n &lt;&lt; <span class="number">2</span>);&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_up</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;t[rt].sum = t[rt &lt;&lt; <span class="number">1</span>].sum + t[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>].sum;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;t[rt].sum);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(rt &lt;&lt; <span class="number">1</span>, l, mid);</span><br><span class="line">        <span class="built_in">build</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r);</span><br><span class="line">        <span class="built_in">push_up</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">op</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> add, <span class="type">int</span> mul)</span> </span>&#123;</span><br><span class="line">        t[rt].sum = (t[rt].sum * mul + (add * (r - l + <span class="number">1</span>)) % mod) % mod;</span><br><span class="line">        t[rt].add = t[rt].add * mul + add, t[rt].add %= mod;</span><br><span class="line">        t[rt].mul *= mul, t[rt].mul %= mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_down</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!t[rt].add &amp;&amp; t[rt].mul == <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">op</span>(rt &lt;&lt; <span class="number">1</span>, l, mid, t[rt].add, t[rt].mul);</span><br><span class="line">        <span class="built_in">op</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, t[rt].add, t[rt].mul);</span><br><span class="line">        t[rt].add = <span class="number">0</span>, t[rt].mul = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr, <span class="type">int</span> add, <span class="type">int</span> mul)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= l &amp;&amp; qr &gt;= r) &#123;</span><br><span class="line">            <span class="built_in">op</span>(rt, l, r, add, mul);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">push_down</span>(rt, l, r);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= mid) <span class="built_in">modify</span>(rt &lt;&lt; <span class="number">1</span>, l, mid, ql, qr, add, mul);</span><br><span class="line">        <span class="keyword">if</span>(qr &gt; mid) <span class="built_in">modify</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, ql, qr, add, mul);</span><br><span class="line">        <span class="built_in">push_up</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= l &amp;&amp; qr &gt;= r) <span class="keyword">return</span> t[rt].sum;</span><br><span class="line">        <span class="built_in">push_down</span>(rt, l, r);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= mid) ans += <span class="built_in">query</span>(rt &lt;&lt; <span class="number">1</span>, l, mid, ql, qr), ans %= mod;</span><br><span class="line">        <span class="keyword">if</span>(qr &gt; mid) ans += <span class="built_in">query</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, ql, qr), ans %= mod; </span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>权值线段树（常加上离散）。</p>
</li>
<li><p>动态开点（不如离散，在线的话那就不得不写了）<a target="_blank" rel="noopener" href="https://51cspnoip.cn/problem/67b68420a864f84569e2cd03">。</a></p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TR</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span> &#123;<span class="type">int</span> l, r, sum, lazy;&#125;;</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">0</span>;</span><br><span class="line">    vector&lt;Node&gt; t;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cl</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;t.<span class="built_in">resize</span>(n);&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_up</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> &amp;rc = t[rt].r, &amp;lc = t[rt].l;</span><br><span class="line">        t[rt].sum = t[lc].sum + t[rc].sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_down</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> &amp;rc = t[rt].r, &amp;lc = t[rt].l;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!lc) lc = ++tot, t[lc].sum = mid - l + <span class="number">1</span>, t[lc].lazy = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!rc) rc = ++tot, t[rc].sum = r - mid, t[rc].lazy = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(t[rt].lazy == <span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">        t[lc].lazy = t[rt].lazy, t[rc].lazy = t[rt].lazy;</span><br><span class="line">        t[lc].sum = (mid - l + <span class="number">1</span>) * t[rt].lazy;</span><br><span class="line">        t[rc].sum = (r - mid) * t[rt].lazy;</span><br><span class="line">        t[rt].lazy = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> &amp;rc = t[rt].r, &amp;lc = t[rt].l;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= l &amp;&amp; qr &gt;= r) &#123;</span><br><span class="line">            t[rt].sum = (r - l + <span class="number">1</span>) * x;</span><br><span class="line">            t[rt].lazy = x;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">push_down</span>(rt, l, r);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= mid) <span class="built_in">modify</span>(lc, l, mid, ql, qr, x);</span><br><span class="line">        <span class="keyword">if</span>(qr &gt; mid) <span class="built_in">modify</span>(rc, mid + <span class="number">1</span>, r, ql, qr, x);</span><br><span class="line">        <span class="built_in">push_up</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, t[<span class="number">1</span>].sum);&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>扫描线：个人习惯是“最小值”和“最小值出现次数”两个标记。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TR</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Min</span> &#123;</span><br><span class="line">        <span class="type">int</span> mi, mic;</span><br><span class="line">        <span class="keyword">friend</span> Min <span class="keyword">operator</span> + (Min a, Min b) &#123;</span><br><span class="line">            <span class="keyword">if</span>(a.mi &gt; b.mi) <span class="built_in">swap</span>(a, b);</span><br><span class="line">            <span class="keyword">return</span> &#123;a.mi, a.mi == b.mi ? a.mic + b.mic : a.mic&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    vector&lt;Min&gt; mi;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; ly;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cl</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        n &lt;&lt;= <span class="number">2</span>;</span><br><span class="line">        mi.<span class="built_in">resize</span>(<span class="number">0</span>), mi.<span class="built_in">resize</span>(n);</span><br><span class="line">        ly.<span class="built_in">resize</span>(<span class="number">0</span>), ly.<span class="built_in">resize</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_up</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;mi[rt] = mi[rt &lt;&lt; <span class="number">1</span>] + mi[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_down</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!ly[rt]) <span class="keyword">return</span>;</span><br><span class="line">        ly[rt &lt;&lt; <span class="number">1</span>] += ly[rt], ly[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] += ly[rt];</span><br><span class="line">        mi[rt &lt;&lt; <span class="number">1</span>].mi += ly[rt];</span><br><span class="line">        mi[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>].mi += ly[rt];</span><br><span class="line">        ly[rt] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">            mi[rt].mi = <span class="number">0</span>, mi[rt].mic = r - l + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(rt &lt;&lt; <span class="number">1</span>, l, mid);</span><br><span class="line">        <span class="built_in">build</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r);</span><br><span class="line">        <span class="built_in">push_up</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= l &amp;&amp; qr &gt;= r) &#123;</span><br><span class="line">            mi[rt].mi += x, ly[rt] += x;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">push_down</span>(rt);</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= mid) <span class="built_in">modify</span>(rt &lt;&lt; <span class="number">1</span>, l, mid, ql, qr, x);</span><br><span class="line">        <span class="keyword">if</span>(qr &gt; mid) <span class="built_in">modify</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, ql, qr, x);</span><br><span class="line">        <span class="built_in">push_up</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>线段树与 01 序列的排序：本质就是 l 到 r，前（后）cnt_0 个个数赋值 0，后（前）cnt_1 个数赋值 1。<br>有意思的是“超大常数（26x）之字母序列区间修改（排序）+ 查询”。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, q;</span><br><span class="line"><span class="type">int</span> ch[N], ans[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TR</span> &#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; sum, lazy;</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">0</span>; </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cl</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        sum.<span class="built_in">resize</span>(n &lt;&lt; <span class="number">2</span>);</span><br><span class="line">        lazy.<span class="built_in">resize</span>(n &lt;&lt; <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; (n &lt;&lt; <span class="number">2</span>); i++) lazy[i] = <span class="number">-1</span>;</span><br><span class="line">        tot = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_up</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;sum[rt] = sum[rt &lt;&lt; <span class="number">1</span>] + sum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">            sum[rt] = (ch[++tot] == x);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(rt &lt;&lt; <span class="number">1</span>, l, mid, x);</span><br><span class="line">        <span class="built_in">build</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, x);</span><br><span class="line">        <span class="built_in">push_up</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_down</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(lazy[rt] == <span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        sum[rt &lt;&lt; <span class="number">1</span>] = (mid - l + <span class="number">1</span>) * lazy[rt];</span><br><span class="line">        sum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = (r - mid) * lazy[rt];</span><br><span class="line">        lazy[rt &lt;&lt; <span class="number">1</span>] = lazy[rt], lazy[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = lazy[rt];</span><br><span class="line">        lazy[rt] = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(ql &gt; qr) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= l &amp;&amp; qr &gt;= r) &#123;</span><br><span class="line">            sum[rt] = (r - l + <span class="number">1</span>) * x;</span><br><span class="line">            lazy[rt] = x;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">push_down</span>(rt, l, r);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= mid) <span class="built_in">modify</span>(rt &lt;&lt; <span class="number">1</span>, l, mid, ql, qr, x);</span><br><span class="line">        <span class="keyword">if</span>(qr &gt; mid) <span class="built_in">modify</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, ql, qr, x);</span><br><span class="line">        <span class="built_in">push_up</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= l &amp;&amp; qr &gt;= r) <span class="keyword">return</span> sum[rt];</span><br><span class="line">        <span class="built_in">push_down</span>(rt, l, r);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= mid) ans += <span class="built_in">query</span>(rt &lt;&lt; <span class="number">1</span>, l, mid, ql, qr);</span><br><span class="line">        <span class="keyword">if</span>(qr &gt; mid) ans += <span class="built_in">query</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, ql, qr);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">summary</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!sum[rt]) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">            ans[l] = x;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">push_down</span>(rt, l, r);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">summary</span>(rt &lt;&lt; <span class="number">1</span>, l, mid, x);</span><br><span class="line">        <span class="built_in">summary</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;t[<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;q);</span><br><span class="line">    <span class="type">char</span> c[N]; <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, c);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) ch[i + <span class="number">1</span>] = c[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">        t[i].<span class="built_in">cl</span>(n);</span><br><span class="line">        t[i].<span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(q--) &#123;</span><br><span class="line">        <span class="type">int</span> l, r, mode; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;l, &amp;r, &amp;mode);</span><br><span class="line">        <span class="type">int</span> cnt[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) cnt[i] = t[i].<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, l, r);</span><br><span class="line">        <span class="keyword">if</span>(mode) <span class="comment">// 升</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>, ln = l; i &lt; <span class="number">26</span>; ln += cnt[i++]) &#123;</span><br><span class="line">                t[i].<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, n, l, r, <span class="number">0</span>);</span><br><span class="line">                t[i].<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, n, ln, ln + cnt[i] - <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>, rn = r; i &lt; <span class="number">26</span>; rn -= cnt[i++]) &#123;</span><br><span class="line">                t[i].<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, n, l, r, <span class="number">0</span>);</span><br><span class="line">                t[i].<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, n, rn - cnt[i] + <span class="number">1</span>, rn, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) t[i].<span class="built_in">summary</span>(<span class="number">1</span>, <span class="number">1</span>, n, i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">char</span> temp = ans[i] + <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, temp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>关于势能，本质就是每次修改会减少（非线性减少）对应点的势能，当其势能低到某处时，对其的操作均无效。<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4145">此类问题</a>线段树加上区间最大（小）势能的标记即可。</li>
</ul>
<hr>
<h3 id="Trie树"><a href="#Trie树" class="headerlink" title="Trie树"></a>Trie树</h3><ul>
<li><p>单独来看没什么用，2 个字母的话就是 01 树，解决位运算问题。</p>
</li>
<li><p>另外就是其扩展的 Trie 图（AC 自动机）。</p>
</li>
</ul>
<hr>
<h3 id="平衡树"><a href="#平衡树" class="headerlink" title="平衡树"></a>平衡树</h3><ul>
<li>Splay，<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2042">这题</a>的代码做模板。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">500100</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> s[<span class="number">2</span>], fa, v, siz;</span><br><span class="line">    <span class="type">int</span> rev, same;</span><br><span class="line">    <span class="type">int</span> ls, rs, ma, sum;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> _v, <span class="type">int</span> _fa)</span> </span>&#123;</span><br><span class="line">        rev = same = s[<span class="number">0</span>] = s[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        fa = _fa, v = _v, sum = ma = v;</span><br><span class="line">        ls = rs = <span class="built_in">max</span>(<span class="number">0</span>, v);</span><br><span class="line">        siz = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;t[N];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, w[N];</span><br><span class="line"><span class="type">int</span> can[N], tot, rt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">push_up</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> lc = t[x].s[<span class="number">0</span>], rc = t[x].s[<span class="number">1</span>];</span><br><span class="line">    t[x].siz = t[lc].siz + t[rc].siz + <span class="number">1</span>;</span><br><span class="line">    t[x].ls = <span class="built_in">max</span>(t[lc].ls, t[lc].sum + t[rc].ls + t[x].v);</span><br><span class="line">    t[x].rs = <span class="built_in">max</span>(t[rc].rs, t[rc].sum + t[lc].rs + t[x].v);</span><br><span class="line">    t[x].ma = <span class="built_in">max</span>(<span class="built_in">max</span>(t[rc].ma, t[lc].ma), t[lc].rs + t[x].v + t[rc].ls);</span><br><span class="line">    t[x].sum = t[lc].sum + t[rc].sum + t[x].v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">push_down</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> lc = t[x].s[<span class="number">0</span>], rc = t[x].s[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span>(t[x].same) &#123;</span><br><span class="line">        t[x].same = t[x].rev = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(lc) &#123;</span><br><span class="line">            t[lc].same = <span class="number">1</span>;</span><br><span class="line">            t[lc].v = t[x].v, t[lc].sum = t[x].v * t[lc].siz;</span><br><span class="line">            t[lc].ls = t[lc].rs = <span class="built_in">max</span>(<span class="number">0</span>, t[x].v * t[lc].siz);</span><br><span class="line">            t[lc].ma = <span class="built_in">max</span>(t[x].v * t[lc].siz, t[x].v);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(rc) &#123;</span><br><span class="line">            t[rc].same = <span class="number">1</span>;</span><br><span class="line">            t[rc].v = t[x].v, t[rc].sum = t[x].v * t[rc].siz;</span><br><span class="line">            t[rc].ls = t[rc].rs = <span class="built_in">max</span>(<span class="number">0</span>, t[x].v * t[rc].siz);</span><br><span class="line">            t[rc].ma = <span class="built_in">max</span>(t[x].v * t[rc].siz, t[x].v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(t[x].rev) &#123;</span><br><span class="line">        t[x].rev = <span class="number">0</span>;</span><br><span class="line">        t[lc].rev ^= <span class="number">1</span>, t[rc].rev ^= <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">swap</span>(t[lc].ls, t[lc].rs);</span><br><span class="line">        <span class="built_in">swap</span>(t[rc].ls, t[rc].rs);</span><br><span class="line">        <span class="built_in">swap</span>(t[lc].s[<span class="number">0</span>], t[lc].s[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">swap</span>(t[rc].s[<span class="number">0</span>], t[rc].s[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> y = t[x].fa, z = t[y].fa;</span><br><span class="line">    <span class="type">bool</span> k = x == t[y].s[<span class="number">1</span>];</span><br><span class="line">    t[z].s[t[z].s[<span class="number">1</span>] == y] = x, t[x].fa = z;</span><br><span class="line">    t[y].s[k] = t[x].s[k ^ <span class="number">1</span>], t[t[x].s[k ^ <span class="number">1</span>]].fa = y;</span><br><span class="line">    t[x].s[k ^ <span class="number">1</span>] = y, t[y].fa = x;</span><br><span class="line">    <span class="built_in">push_up</span>(y); <span class="built_in">push_up</span>(x); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(t[x].fa != a) &#123;</span><br><span class="line">        <span class="type">int</span> y = t[x].fa, z = t[y].fa;</span><br><span class="line">        <span class="keyword">if</span>(z != a)</span><br><span class="line">            <span class="keyword">if</span>((t[z].s[<span class="number">1</span>] == y) ^ (t[y].s[<span class="number">1</span>] == x)) <span class="built_in">rotate</span>(x);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(y);</span><br><span class="line">        <span class="built_in">rotate</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!a) rt = x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_k</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> u = rt;</span><br><span class="line">    <span class="keyword">while</span>(u) &#123;</span><br><span class="line">        <span class="built_in">push_down</span>(u);</span><br><span class="line">        <span class="keyword">if</span>(t[t[u].s[<span class="number">0</span>]].siz &gt;= k) u = t[u].s[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(t[t[u].s[<span class="number">0</span>]].siz + <span class="number">1</span> == k) <span class="keyword">return</span> u;</span><br><span class="line">        <span class="keyword">else</span> k -= t[t[u].s[<span class="number">0</span>]].siz + <span class="number">1</span>, u = t[u].s[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> u = can[tot--];</span><br><span class="line">    <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    t[u].<span class="built_in">init</span>(w[mid], fa);</span><br><span class="line">    <span class="keyword">if</span>(l &lt; mid) t[u].s[<span class="number">0</span>] = <span class="built_in">build</span>(l, mid - <span class="number">1</span>, u);</span><br><span class="line">    <span class="keyword">if</span>(r &gt; mid) t[u].s[<span class="number">1</span>] = <span class="built_in">build</span>(mid + <span class="number">1</span>, r, u);</span><br><span class="line">    <span class="built_in">push_up</span>(u);</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(t[x].s[<span class="number">0</span>]) <span class="built_in">dfs</span>(t[x].s[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">if</span>(t[x].s[<span class="number">1</span>]) <span class="built_in">dfs</span>(t[x].s[<span class="number">1</span>]);</span><br><span class="line">    can[++tot] = x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = N - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) can[++tot] = i;</span><br><span class="line">    t[<span class="number">0</span>].ma = w[<span class="number">0</span>] = w[n + <span class="number">1</span>] = <span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;w[i]);</span><br><span class="line">    rt = <span class="built_in">build</span>(<span class="number">0</span>, n + <span class="number">1</span>, <span class="number">0</span>);<span class="comment">//建splay </span></span><br><span class="line">    <span class="keyword">while</span>(m--) &#123;</span><br><span class="line">        <span class="type">char</span> mode[<span class="number">20</span>]; <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, mode);</span><br><span class="line">        <span class="keyword">if</span>(mode[<span class="number">0</span>] == <span class="string">&#x27;I&#x27;</span>) &#123;</span><br><span class="line">            <span class="type">int</span> posi, a; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;posi, &amp;a);</span><br><span class="line">            <span class="type">int</span> r = <span class="built_in">get_k</span>(posi + <span class="number">2</span>);</span><br><span class="line">            posi = <span class="built_in">get_k</span>(posi + <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">splay</span>(posi, <span class="number">0</span>); <span class="built_in">splay</span>(r, posi);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; a; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;w[i]);</span><br><span class="line">            t[r].s[<span class="number">0</span>] = <span class="built_in">build</span>(<span class="number">0</span>, a - <span class="number">1</span>, r);</span><br><span class="line">            <span class="built_in">push_up</span>(r); <span class="built_in">push_up</span>(posi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(mode[<span class="number">0</span>] == <span class="string">&#x27;D&#x27;</span>) &#123;</span><br><span class="line">            <span class="type">int</span> posi, a; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;posi, &amp;a);</span><br><span class="line">            <span class="type">int</span> r = <span class="built_in">get_k</span>(posi + a + <span class="number">1</span>);</span><br><span class="line">            posi = <span class="built_in">get_k</span>(posi);</span><br><span class="line">            <span class="built_in">splay</span>(posi, <span class="number">0</span>); <span class="built_in">splay</span>(r, posi);</span><br><span class="line">            <span class="built_in">dfs</span>(t[r].s[<span class="number">0</span>]);</span><br><span class="line">            t[r].s[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">push_up</span>(r); <span class="built_in">push_up</span>(posi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(mode[<span class="number">2</span>] == <span class="string">&#x27;K&#x27;</span>) &#123;</span><br><span class="line">            <span class="type">int</span> posi, a, c; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;posi, &amp;a, &amp;c);</span><br><span class="line">            <span class="type">int</span> r = <span class="built_in">get_k</span>(posi + a + <span class="number">1</span>);</span><br><span class="line">            posi = <span class="built_in">get_k</span>(posi);</span><br><span class="line">            <span class="built_in">splay</span>(posi, <span class="number">0</span>); <span class="built_in">splay</span>(r, posi);</span><br><span class="line">            <span class="type">int</span> s = t[r].s[<span class="number">0</span>];</span><br><span class="line">            t[s].same = <span class="number">1</span>, t[s].v = c, t[s].sum = c * t[s].siz;</span><br><span class="line">            t[s].ls = t[s].rs = <span class="built_in">max</span>(<span class="number">0</span>, c * t[s].siz);</span><br><span class="line">            t[s].ma = <span class="built_in">max</span>(c * t[s].siz, c);</span><br><span class="line">            <span class="built_in">push_up</span>(r); <span class="built_in">push_up</span>(posi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(mode[<span class="number">0</span>] == <span class="string">&#x27;R&#x27;</span>) &#123;</span><br><span class="line">            <span class="type">int</span> posi, a; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;posi, &amp;a);</span><br><span class="line">            <span class="type">int</span> r = <span class="built_in">get_k</span>(posi + a + <span class="number">1</span>);</span><br><span class="line">            posi = <span class="built_in">get_k</span>(posi);</span><br><span class="line">            <span class="built_in">splay</span>(posi, <span class="number">0</span>); <span class="built_in">splay</span>(r, posi);</span><br><span class="line">            <span class="type">int</span> s = t[r].s[<span class="number">0</span>];</span><br><span class="line">            t[s].rev ^= <span class="number">1</span>;</span><br><span class="line">            <span class="built_in">swap</span>(t[s].ls, t[s].rs);</span><br><span class="line">            <span class="built_in">swap</span>(t[s].s[<span class="number">0</span>], t[s].s[<span class="number">1</span>]);</span><br><span class="line">            <span class="built_in">push_up</span>(r); <span class="built_in">push_up</span>(posi);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(mode[<span class="number">0</span>] == <span class="string">&#x27;G&#x27;</span>) &#123;</span><br><span class="line">            <span class="type">int</span> posi, a; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;posi, &amp;a);</span><br><span class="line">            <span class="type">int</span> r = <span class="built_in">get_k</span>(posi + a + <span class="number">1</span>);</span><br><span class="line">            posi = <span class="built_in">get_k</span>(posi);</span><br><span class="line">            <span class="built_in">splay</span>(posi, <span class="number">0</span>); <span class="built_in">splay</span>(r, posi);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, t[t[r].s[<span class="number">0</span>]].sum);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(mode[<span class="number">2</span>] == <span class="string">&#x27;X&#x27;</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, t[rt].ma);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="">FHQ-Treap</a>，一个“强大、简洁、实用”的平衡树，其内核就是<strong>分裂</strong>与<strong>合并</strong>，下面是一些基础函数。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> root;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;<span class="type">int</span> l, r, x<span class="comment">/*信息*/</span>, key, <span class="comment">/*其他东西*/</span>;&#125; t[N];</span><br><span class="line"><span class="type">int</span> tot;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">make</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    t[++tot] = &#123;<span class="number">0</span>, <span class="number">0</span>, x, <span class="built_in">rnd</span>(), <span class="comment">/*其它东西的初始化*/</span>&#125;;</span><br><span class="line">    <span class="keyword">return</span> tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build_key</span><span class="params">()</span> </span>&#123; <span class="comment">// 基于 key</span></span><br><span class="line">    deque&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    <span class="built_in">sort</span>(A + <span class="number">1</span>, A + n + <span class="number">1</span>); <span class="comment">// 对于 val 递增</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> tmp = <span class="built_in">make</span>(A[i]), last = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>() &amp;&amp; t[q.<span class="built_in">back</span>()].key &gt; t[tmp].key) <span class="built_in">push_up</span>(last = q.<span class="built_in">back</span>()), q.<span class="built_in">pop_back</span>();</span><br><span class="line">        <span class="comment">// tmp 插入 q.back() 和 last 之间</span></span><br><span class="line">        <span class="keyword">if</span>(!q.<span class="built_in">empty</span>()) t[q.<span class="built_in">back</span>()].r = tmp;</span><br><span class="line">        t[tmp].l = last, q.<span class="built_in">push_back</span>(tmp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> rt = q.<span class="built_in">front</span>();</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) <span class="built_in">push_up</span>(q.<span class="built_in">back</span>()), q.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build_none_key</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123; <span class="comment">// 舍弃 key</span></span><br><span class="line">    <span class="keyword">if</span>(l &gt; r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> tmp = <span class="built_in">make</span>(A[mid]);</span><br><span class="line">    t[tmp].l = <span class="built_in">build</span>(l, mid - <span class="number">1</span>), t[tmp].r = <span class="built_in">build</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">push_up</span>(tmp);</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">split_val</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> k, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> &amp;lc = t[rt].l, &amp;rc = t[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(!rt) &#123;x = y = <span class="number">0</span>; <span class="keyword">return</span>;&#125; <span class="comment">// 注意</span></span><br><span class="line">    <span class="built_in">push_down</span>(rt);</span><br><span class="line">    <span class="keyword">if</span>(t[rt].x &lt;= k) x = rt, <span class="built_in">split</span>(rc, k, rc, y);</span><br><span class="line">    <span class="keyword">else</span> y = rt, <span class="built_in">split</span>(lc, k, x, lc);</span><br><span class="line">    <span class="built_in">push_up</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">split_kth</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> k, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!rt) &#123;x = y = <span class="number">0</span>; <span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="built_in">push_down</span>(rt);</span><br><span class="line">    <span class="type">int</span> &amp;lc = t[rt].l, &amp;rc = t[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(t[lc].siz + <span class="number">1</span> &lt;= k) x = rt, <span class="built_in">split</span>(rc, k - t[lc].siz - <span class="number">1</span>, rc, y); <span class="comment">// 注意是 k - t[lc].siz - 1</span></span><br><span class="line">    <span class="keyword">else</span> y = rt, <span class="built_in">split</span>(lc, k, x, lc);</span><br><span class="line">    <span class="built_in">push_up</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">merge_key</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123; <span class="comment">// 基于 key</span></span><br><span class="line">    <span class="keyword">if</span>(!x || !y) <span class="keyword">return</span> <span class="built_in">max</span>(x, y); <span class="comment">// 注意</span></span><br><span class="line">    <span class="keyword">if</span>(t[x].key &lt;= t[y].key) &#123;</span><br><span class="line">        <span class="built_in">push_down</span>(x);</span><br><span class="line">        t[x].r = <span class="built_in">merge</span>(t[x].r, y);</span><br><span class="line">        <span class="built_in">push_up</span>(x);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">push_down</span>(y);</span><br><span class="line">        t[y].l = <span class="built_in">merge</span>(x, t[y].l);</span><br><span class="line">        <span class="built_in">push_up</span>(y);</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">merge_none_key</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123; <span class="comment">// 舍弃 key</span></span><br><span class="line">    <span class="keyword">if</span>(!x || !y) <span class="keyword">return</span> <span class="built_in">max</span>(x, y);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Rand</span>(t[x].siz + t[y].siz) &lt;= t[x].siz) &#123;</span><br><span class="line">        <span class="built_in">push_down</span>(x);</span><br><span class="line">        t[x].r = <span class="built_in">merge</span>(t[x].r, y);</span><br><span class="line">        <span class="built_in">push_up</span>(x);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">push_down</span>(y);</span><br><span class="line">        t[y].l = <span class="built_in">merge</span>(x, t[y].l);</span><br><span class="line">        <span class="built_in">push_up</span>(y);</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find_kth</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> &amp;lc = t[rt].l, &amp;rc = t[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(t[lc].siz + <span class="number">1</span> == k) <span class="keyword">return</span> rt;</span><br><span class="line">    <span class="built_in">push_down</span>(rt);</span><br><span class="line">    <span class="keyword">if</span>(t[lc].siz + <span class="number">1</span> &gt; k) <span class="keyword">return</span> <span class="built_in">find</span>(lc, k);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">find</span>(rc, k - t[lc].siz - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> idx;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!rt) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">push_down</span>(rt);</span><br><span class="line">    <span class="built_in">dfs</span>(t[rt].l);</span><br><span class="line">    A[++idx] = t[rt].x;</span><br><span class="line">    <span class="built_in">dfs</span>(t[rt].r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rebuild</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    idx = <span class="number">0</span>, <span class="built_in">dfs</span>(root);</span><br><span class="line">    tot = <span class="number">0</span>, root = <span class="built_in">build</span>(<span class="number">1</span>, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>&nbsp;</p>
<h2 id="可持久化数据结构"><a href="#可持久化数据结构" class="headerlink" title="可持久化数据结构"></a>可持久化数据结构</h2><h3 id="可持久化并查集"><a href="#可持久化并查集" class="headerlink" title="可持久化并查集"></a>可持久化并查集</h3><ul>
<li>启发式（按秩）合并，并记下操作序列，<del>这是虚假的可持久化</del>。</li>
</ul>
<hr>
<h3 id="可持久化线段树"><a href="#可持久化线段树" class="headerlink" title="可持久化线段树"></a>可持久化线段树</h3><ul>
<li>难以找到一个很模范的板子，所以带着<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4137">题目</a>放过来，当作写法借鉴（还掺了线段树二分）。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m, d[N];</span><br><span class="line"><span class="type">int</span> rt[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TR</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span> &#123;<span class="type">int</span> l, r, left;&#125;;</span><br><span class="line">    vector&lt;Node&gt; t;</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        tot = <span class="number">0</span>;</span><br><span class="line">        t.<span class="built_in">resize</span>(<span class="number">0</span>); t.<span class="built_in">resize</span>(N * <span class="number">24</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> &amp;rt, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> &amp;lc = t[rt].l, &amp;rc = t[rt].r;</span><br><span class="line">        rt = ++tot;</span><br><span class="line">        <span class="keyword">if</span>(l == r) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(lc, l, mid);</span><br><span class="line">        <span class="built_in">build</span>(rc, mid + <span class="number">1</span>, r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_up</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> &amp;lc = t[rt].l, &amp;rc = t[rt].r;</span><br><span class="line">        t[rt].left = <span class="built_in">min</span>(t[lc].left, t[rc].left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">make</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">        t[++tot] = t[rt];</span><br><span class="line">        <span class="keyword">return</span> tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> n, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> &amp;lc = t[rt].l, &amp;rc = t[rt].r, temp = <span class="built_in">make</span>(rt);</span><br><span class="line">        <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">            t[temp].left = x;</span><br><span class="line">            <span class="keyword">return</span> temp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(n &lt;= mid) t[temp].l = <span class="built_in">modify</span>(lc, l, mid, n, x);</span><br><span class="line">        <span class="keyword">else</span> t[temp].r = <span class="built_in">modify</span>(rc, mid + <span class="number">1</span>, r, n, x);</span><br><span class="line">        <span class="built_in">push_up</span>(temp);</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> &amp;lc = t[rt].l, &amp;rc = t[rt].r;</span><br><span class="line">        <span class="keyword">if</span>(l == r) <span class="keyword">return</span> l;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(t[lc].left &lt; ql) <span class="keyword">return</span> <span class="built_in">find</span>(lc, l, mid, ql);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">find</span>(rc, mid + <span class="number">1</span>, r, ql);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;t;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    t.<span class="built_in">cl</span>();</span><br><span class="line">    t.<span class="built_in">build</span>(rt[<span class="number">0</span>], <span class="number">0</span>, n); </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;d[i]);</span><br><span class="line">        <span class="keyword">if</span>(d[i] &gt; n) rt[i] = rt[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span> rt[i] = t.<span class="built_in">modify</span>(rt[i - <span class="number">1</span>], <span class="number">0</span>, n, d[i], i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(m--) &#123;</span><br><span class="line">        <span class="type">int</span> l, r; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, t.<span class="built_in">find</span>(rt[r], <span class="number">0</span>, n ,l));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>上例中没有提及可持久化线段树的一个重要思想：新版本与老版本点对点做差，以得出两版本之间的信息。</li>
</ul>
<hr>
<h3 id="可持久化-Trie-树"><a href="#可持久化-Trie-树" class="headerlink" title="可持久化 Trie 树"></a>可持久化 Trie 树</h3><ul>
<li>这道<a target="_blank" rel="noopener" href="https://51cspnoip.cn/problem/67c65187a864f8456914ebfc">题</a>补上刚才所未提及的思想（其实终归都是树结构，大差不差）。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, q, XOR, cnt = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> rt[M];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TiR</span> &#123;</span><br><span class="line">    <span class="type">int</span> son[M * <span class="number">32</span>][<span class="number">2</span>], vis[M * <span class="number">32</span>];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> od)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> nw = ++tot, temp = nw;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = N; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            son[nw][<span class="number">0</span>] = son[od][<span class="number">0</span>], son[nw][<span class="number">1</span>] = son[od][<span class="number">1</span>];</span><br><span class="line">            vis[nw] = vis[od] + <span class="number">1</span>;</span><br><span class="line">            son[nw][<span class="number">1</span> &amp; (x &gt;&gt; i)] = ++tot;</span><br><span class="line">            nw = tot, od = son[od][<span class="number">1</span> &amp; (x &gt;&gt; i)];</span><br><span class="line">        &#125;</span><br><span class="line">        vis[nw] = vis[od] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> v1, <span class="type">int</span> v2)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = N; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="type">int</span> c = <span class="number">1</span> &amp; (x &gt;&gt; i);</span><br><span class="line">            c = !c;</span><br><span class="line">            <span class="keyword">if</span>(vis[son[v2][c]] - vis[son[v1][c]] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                ans |= (<span class="number">1</span> &lt;&lt; i);</span><br><span class="line">                v1 = son[v1][c], v2 = son[v2][c];</span><br><span class="line">            &#125; <span class="keyword">else</span> v1 = son[v1][!c], v2 = son[v2][!c];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;t;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;q);</span><br><span class="line">    rt[<span class="number">1</span>] = t.<span class="built_in">insert</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span>(++cnt &lt;= n + <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> a; <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a);</span><br><span class="line">        XOR ^= a;</span><br><span class="line">        rt[cnt] = t.<span class="built_in">insert</span>(XOR, rt[cnt - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    cnt--;</span><br><span class="line">    <span class="keyword">while</span>(q--) &#123;</span><br><span class="line">        <span class="type">char</span> c[<span class="number">2</span>]; <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, c);</span><br><span class="line">        <span class="keyword">if</span>(c[<span class="number">0</span>] == <span class="string">&#x27;A&#x27;</span>) &#123;</span><br><span class="line">            <span class="type">int</span> a; <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a);</span><br><span class="line">            XOR ^= a;</span><br><span class="line">            rt[cnt] = t.<span class="built_in">insert</span>(XOR, rt[++cnt - <span class="number">1</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> l, r, x; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;l, &amp;r, &amp;x);</span><br><span class="line">            <span class="type">int</span> temp = XOR ^ x;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, t.<span class="built_in">query</span>(temp, rt[l - <span class="number">1</span>], rt[r]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="可持久化-FHQ-Treap"><a href="#可持久化-FHQ-Treap" class="headerlink" title="可持久化 FHQ-Treap"></a>可持久化 FHQ-Treap</h3><ul>
<li><p>FHQ-Treap 相较于基于旋转的 Treap，一个很好的性质就是它可以做可持久化。</p>
</li>
<li><p>思想大差不差。关于 clone 在哪用？<strong>一切会改变这个节点的操作前 clone</strong>。<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/256859704">Code</a> is too long to put here。</p>
</li>
</ul>
<hr>
<p>&nbsp;</p>
<h2 id="进阶数据结构"><a href="#进阶数据结构" class="headerlink" title="进阶数据结构"></a>进阶数据结构</h2><h3 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h3><blockquote>
<p>这是一个（我们）不常用但强大且简单（“简单”有待商榷）的数据结构</p>
</blockquote>
<ul>
<li><p>其主要功能：通过关键码值（key）进行快速数据访问的结构。而手写哈希表主要是为了将离散的下标映射成连续的下标以达到快速、节约地进行<strong>超大下标</strong>的数据操作，比如状压 DP 中会产生大量非法状态的空间浪费，插头 DP 空间浪费更严重。</p>
</li>
<li><p>手写哈希表主要是“哈希<strong>挂</strong>表”的形式，由于我习惯了链式前向星，所以延续了链式前向星的一些传统。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> val[N], num[N], idx;</span><br><span class="line"><span class="type">int</span> h[N], ne[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> a)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> key = x % mod;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[key]; ~i; i = ne[i]) <span class="keyword">if</span>(num[i] == x) &#123;</span><br><span class="line">        val[i] += a;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    num[idx] = x, val[idx] = a;</span><br><span class="line">    ne[idx] = h[key], h[key] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> key = x % mod;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[key]; ~i; i = ne[i]) <span class="keyword">if</span>(num[i] == x) <span class="keyword">return</span> val[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="主席树"><a href="#主席树" class="headerlink" title="主席树"></a>主席树</h3><ul>
<li>权值线段树 + 可持久化 + 线段树二分（第 k 小）。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> rt[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TR</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span> &#123;<span class="type">int</span> l, r, sum;&#125;;</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">0</span>;</span><br><span class="line">    vector&lt;Node&gt; t;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cl</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m)</span> </span>&#123; <span class="comment">// n为值域</span></span><br><span class="line">        tot = <span class="number">0</span>;</span><br><span class="line">        t.<span class="built_in">resize</span>(<span class="number">0</span>); t.<span class="built_in">resize</span>(N * <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">make</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">        t[++tot] = t[rt];</span><br><span class="line">        <span class="keyword">return</span> tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_up</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> &amp;lc = t[rt].l, &amp;rc = t[rt].r;</span><br><span class="line">        t[rt].sum = t[lc].sum + t[rc].sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> &amp;rt, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        rt = ++tot;</span><br><span class="line">        <span class="type">int</span> &amp;lc = t[rt].l, &amp;rc = t[rt].r;</span><br><span class="line">        <span class="keyword">if</span>(l == r) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(lc, l, mid);</span><br><span class="line">        <span class="built_in">build</span>(rc, mid + <span class="number">1</span>, r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> &amp;lc = t[rt].l, &amp;rc = t[rt].r, temp = <span class="built_in">make</span>(rt);</span><br><span class="line">        <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">            t[temp].sum++;</span><br><span class="line">            <span class="keyword">return</span> temp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(n &lt;= mid) t[temp].l = <span class="built_in">modify</span>(lc, l, mid, n);</span><br><span class="line">        <span class="keyword">else</span> t[temp].r = <span class="built_in">modify</span>(rc, mid + <span class="number">1</span>, r, n);</span><br><span class="line">        <span class="built_in">push_up</span>(temp);</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> v1, <span class="type">int</span> v2, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l == r) <span class="keyword">return</span> l;</span><br><span class="line">        <span class="type">int</span> &amp;lc1 = t[v1].l, &amp;rc1 = t[v1].r;</span><br><span class="line">        <span class="type">int</span> &amp;lc2 = t[v2].l, &amp;rc2 = t[v2].r;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>, temp = t[lc2].sum - t[lc1].sum;</span><br><span class="line">        <span class="keyword">if</span>(temp &gt;= k) <span class="keyword">return</span> <span class="built_in">find</span>(lc1, lc2, l, mid, k);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">find</span>(rc1, rc2, mid + <span class="number">1</span>, r, k - temp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<ul>
<li>树上主席树见 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/212049895"><strong>Code is Too Long!!!</strong></a></li>
</ul>
<hr>
<h3 id="李超线段树"><a href="#李超线段树" class="headerlink" title="李超线段树"></a>李超线段树</h3><ul>
<li><p>整个树结构维护这样一件事：保证“若将根到叶子<strong>路径</strong>上所有函数下放到底，可以得到叶子的答案”。<br>如何维护这件事呢？暴力的做法是对每个点做一遍，但我们想<strong>利用线性函数的单调性</strong>，做一个<strong>类二分的剪枝</strong>。那么我们可以为各个区间选一个“代表点”，各个节点维护其“代表点”在其<strong>子树中</strong>的最优函数，于是，下放的函数显然只能向左或向右更新（或不更新）。最后，取“代表点”为区间中点时，复杂度最优。<br>然后你就了解了李超树的基础。</p>
</li>
<li><p>一点性质：若为<strong>直线</strong>且动态开点，“树上的节点”到“直线”的映射是双射。</p>
</li>
<li><p><strong>一定要注意</strong>，cmp 关系一定要满足<strong>强序关系</strong>，否则一条线不只存在一次。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Line</span> &#123;ll k, b; <span class="type">int</span> l, r;&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    Line L;</span><br><span class="line">    <span class="type">int</span> lc, rc;</span><br><span class="line">&#125;t[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> tot;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">make</span><span class="params">(Line x)</span> </span>&#123;</span><br><span class="line">    t[++tot] = &#123;x, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">return</span> tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> &amp;rt, <span class="type">int</span> l, <span class="type">int</span> r, Line x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!rt) &#123;rt = <span class="built_in">make</span>(x); <span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// cmp(a, b, x): a 优先级更高 ? 1 : 0</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">cmp</span>(x, t[rt].L, mid)) <span class="built_in">swap</span>(t[rt].L, x);</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">cmp</span>(x, t[rt].L, l)) <span class="built_in">add</span>(t[rt].lc, l, mid, x);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">cmp</span>(x, t[rt].L, r)) <span class="built_in">add</span>(t[rt].rc, mid + <span class="number">1</span>, r, x);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> &amp;rt, <span class="type">int</span> l, <span class="type">int</span> r, Line x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x.l &lt;= l &amp;&amp; x.r &gt;= r) &#123;</span><br><span class="line">        <span class="built_in">add</span>(rt, l, r, x);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!rt) rt = <span class="built_in">make</span>(&#123;<span class="number">0</span>, INF&#125;); <span class="comment">// 或 -INF</span></span><br><span class="line">    <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x.l &lt;= mid) <span class="built_in">modify</span>(t[rt].lc, l, mid, x);</span><br><span class="line">    <span class="keyword">if</span>(x.r &gt; mid) <span class="built_in">modify</span>(t[rt].rc, mid + <span class="number">1</span>, r, x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r, ll x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!rt) <span class="keyword">return</span> INF; <span class="comment">// 或 -INF</span></span><br><span class="line">    <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    ll ans;</span><br><span class="line">    <span class="keyword">if</span>(x &lt;= mid) ans = <span class="built_in">query</span>(t[rt].lc, l, mid, x);</span><br><span class="line">    <span class="keyword">else</span> ans = <span class="built_in">query</span>(t[rt].rc, mid + <span class="number">1</span>, r, x);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(ans, t[rt].L.k * (x - O) + t[rt].L.b); <span class="comment">// 或 max</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="根号分治（更多的是思想层面）"><a href="#根号分治（更多的是思想层面）" class="headerlink" title="根号分治（更多的是思想层面）"></a>根号分治（更多的是思想层面）</h3><blockquote>
<p>这一部分也是刚刚<a target="_blank" rel="noopener" href="https://www.cnblogs.com/TKXZ133/p/17772749.html">新学的</a>，还没学<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/article/5gtqzd4a">深</a></p>
</blockquote>
<ul>
<li>可以找出界限分明的两种算法（其中一种常为部分分给的暴力），一种对于规模小，数量多的问题；一种对于规模大，数量少的问题。而且“<strong>类打表</strong>”的行为很常见。</li>
</ul>
<hr>
<h3 id="莫队"><a href="#莫队" class="headerlink" title="莫队"></a><a target="_blank" rel="noopener" href="https://oi-wiki.org/misc/mo-algo-intro/">莫队</a></h3><blockquote>
<p>这个学的不<a target="_blank" rel="noopener" href="https://www.cnblogs.com/MortisLife/p/18962510">深</a></p>
</blockquote>
<hr>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id="图论"><a href="#图论" class="headerlink" title="图论"></a>图论</h1><h2 id="树"><a href="#树" class="headerlink" title="树"></a>树</h2><h3 id="Bases-3"><a href="#Bases-3" class="headerlink" title="Bases"></a>Bases</h3><ul>
<li><p>树的中心：dep 域意义上的中心，<a target="_blank" rel="noopener" href="https://oi-wiki.org/graph/tree-center/">了解</a>即可。</p>
</li>
<li><p>树的重心：siz 域意义上的中心，<a target="_blank" rel="noopener" href="https://oi-wiki.org/graph/tree-centroid/#%E6%80%A7%E8%B4%A8/">性质</a>很重要。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> tot, wc;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_tot</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i])</span><br><span class="line">        <span class="keyword">if</span>(e[i] != l) sum += <span class="built_in">get_tot</span>(e[i], x);</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_wc</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ma = <span class="number">0</span>, sum = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == l) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> tmp = <span class="built_in">get_wc</span>(j, x);</span><br><span class="line">        ma = <span class="built_in">max</span>(ma, tmp), sum += tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    ma = <span class="built_in">max</span>(ma, tot - sum);</span><br><span class="line">    <span class="keyword">if</span>(ma &lt;= tot / <span class="number">2</span>) wc = x;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://oi-wiki.org/graph/tree-diameter/">树的直径</a>：最长的任意简单路径，也很重要。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> ans; <span class="comment">// 直径</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">DP</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ma = <span class="number">0</span>, sub_ma = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == l) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> tmp = <span class="built_in">DP</span>(j, x) + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(tmp &gt; ma) sub_ma = ma, ma = tmp;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(tmp &gt; sub_ma) sub_ma = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = <span class="built_in">max</span>(ans, ma + sub_ma);</span><br><span class="line">    <span class="keyword">return</span> ma;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>LCA（最近公共祖先），两种做法，倍增（常用）和树链剖分。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> rt; <span class="comment">// LCA 基于有根树</span></span><br><span class="line"><span class="type">int</span> fa[N][<span class="number">25</span>], dep[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l)</span> </span>&#123;</span><br><span class="line">    fa[x][<span class="number">0</span>] = l, dep[x] = dep[l] + <span class="number">1</span>;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">25</span>; i++) fa[x][i] = fa[fa[x][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) <span class="keyword">if</span>(e[i] != l) <span class="built_in">dfs</span>(e[i], x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep[a] &lt; dep[b]) <span class="built_in">swap</span>(a, b);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">24</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        <span class="keyword">if</span>(dep[fa[a][i]] &gt;= dep[b]) a = fa[a][i];</span><br><span class="line">    <span class="keyword">if</span>(a == b) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">24</span>; i &gt;= <span class="number">0</span>; i--) <span class="keyword">if</span>(fa[a][i] != fa[b][i])</span><br><span class="line">        a = fa[a][i], b = fa[b][i];</span><br><span class="line">    <span class="keyword">return</span> fa[a][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ul>
<li>DFS 序，这部分是绝大多数树上问题的基石。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> rt; <span class="comment">// DFS序基于有根树</span></span><br><span class="line"><span class="type">int</span> L[N], R[N], dfn[N], cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l)</span> </span>&#123;</span><br><span class="line">    L[x] = ++cnt, dfn[cnt] = x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i])</span><br><span class="line">        <span class="keyword">if</span>(e[i] != l) <span class="built_in">dfs</span>(e[i], x);</span><br><span class="line">    R[x] = cnt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="树链剖分"><a href="#树链剖分" class="headerlink" title="树链剖分"></a>树链剖分</h3><ul>
<li>支持很多操作。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> fa[N], siz[N], ma_s[N], dep[N], top[N];</span><br><span class="line"><span class="type">int</span> dfn[N], L[N], R[N], cnt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_pre</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l)</span> </span>&#123;</span><br><span class="line">    fa[x] = l, siz[x] = <span class="number">1</span>, dep[x] = dep[l] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == l) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs_pre</span>(j, x);</span><br><span class="line">        siz[x] += siz[j];</span><br><span class="line">        <span class="keyword">if</span>(siz[j] &gt; siz[ma_s[x]]) ma_s[x] = j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_top</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> tp)</span> </span>&#123;</span><br><span class="line">    dfn[++cnt] = x, L[x] = cnt, top[x] = tp;</span><br><span class="line">    <span class="keyword">if</span>(ma_s[x]) <span class="built_in">dfs_top</span>(ma_s[x], tp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == fa[x] || j == ma_s[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs_top</span>(j, j);</span><br><span class="line">    &#125;</span><br><span class="line">    R[x] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify_path</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> delta)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(top[x] != top[y]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[top[x]] &lt; dep[top[y]]) <span class="built_in">swap</span>(x, y);</span><br><span class="line">        t.<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, n, L[top[x]], L[x], delta);</span><br><span class="line">        x = fa[top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dep[x] &lt; dep[y]) <span class="built_in">swap</span>(x, y);</span><br><span class="line">    t.<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, n, L[y], L[x], delta);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query_path</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(top[x] != top[y]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[top[x]] &lt; dep[top[y]]) <span class="built_in">swap</span>(x, y);</span><br><span class="line">        ans += t.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, L[top[x]], L[x]);</span><br><span class="line">        x = fa[top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dep[x] &lt; dep[y]) <span class="built_in">swap</span>(x, y);</span><br><span class="line">    ans += t.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, L[y], L[x]);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify_subtr</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> delta)</span> </span>&#123;t.<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, n, L[x], R[x], delta);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query_subtr</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">return</span> t.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, L[x], R[x]);&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="点分治"><a href="#点分治" class="headerlink" title="点分治"></a>点分治</h3><ul>
<li>合并各个子树得到答案有两种方法：<br>动态直接计算（对于<strong>按顺序计算</strong>的每个子树只累加<strong>它对之前子树的贡献</strong>）；<br>容斥（对于各个子树减去<strong>内部冲突的假贡献</strong>再累加<strong>所有子树混合</strong>得到的答案）。<br>以下是<a target="_blank" rel="noopener" href="https://51cspnoip.cn/problem/6248426f4c13a61f1bc904ad">此题</a>（我更倾向的）容斥写法。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> k;</span><br><span class="line"><span class="type">bool</span> del[N];</span><br><span class="line"><span class="type">int</span> dis[N], d_temp[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_tot</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(del[x]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == l) <span class="keyword">continue</span>;</span><br><span class="line">        sum += <span class="built_in">get_tot</span>(j, x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_wc</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> tot, <span class="type">int</span> &amp; wc)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(del[x]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> ma = <span class="number">0</span>, sum = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == l) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> temp = <span class="built_in">get_wc</span>(j, x, tot, wc);</span><br><span class="line">        sum += temp, ma = <span class="built_in">max</span>(ma, temp);</span><br><span class="line">    &#125;</span><br><span class="line">    ma = <span class="built_in">max</span>(ma, tot - sum);</span><br><span class="line">    <span class="keyword">if</span>(ma &lt;= tot / <span class="number">2</span>) wc = x;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_dis</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> d, <span class="type">int</span> &amp; pt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(del[x] || d &gt; k) <span class="keyword">return</span>;</span><br><span class="line">    d_temp[++pt] = d;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == l) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">get_dis</span>(j, x, d + v[i], pt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">F</span><span class="params">(<span class="type">int</span> d[], <span class="type">int</span> siz)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(d + <span class="number">1</span>, d + siz + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> l = <span class="number">1</span>, r = siz, ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(l &lt; r) &#123;</span><br><span class="line">        <span class="keyword">while</span>(d[l + <span class="number">1</span>] + d[r] &lt;= k &amp;&amp; l &lt; r - <span class="number">1</span>) l++;</span><br><span class="line">        <span class="keyword">if</span>(d[l] + d[r] &lt;= k) ans += l;</span><br><span class="line">        r--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans + ((r * (r - <span class="number">1</span>)) / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(del[rt]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">get_wc</span>(rt, <span class="number">-1</span>, <span class="built_in">get_tot</span>(rt, <span class="number">-1</span>), rt);</span><br><span class="line">    del[rt] = <span class="literal">true</span>;</span><br><span class="line">    <span class="type">int</span> dt = <span class="number">0</span>, ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[rt]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i], pt = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">get_dis</span>(j, rt, v[i], pt);</span><br><span class="line">        ans -= <span class="built_in">F</span>(d_temp, pt);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= pt; i++) dis[++dt] = d_temp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    ans += <span class="built_in">F</span>(dis, dt);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= dt; i++) <span class="keyword">if</span>(dis[i] &lt;= k) ans++;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[rt]; ~i; i = ne[i]) ans += <span class="built_in">calc</span>(e[i]);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="DSU-on-Tree（启发式算法）"><a href="#DSU-on-Tree（启发式算法）" class="headerlink" title="DSU on Tree（启发式算法）"></a>DSU on Tree（启发式算法）</h3><ul>
<li>启发式算法，正所谓“启发式”，旨在于其思想（小并大），而这个所谓的模板，其实就是一种较规范化的写法，并非某种定式模板<a target="_blank" rel="noopener" href="https://51cspnoip.cn/problem/67e4adb74db8107579234a53">。</a></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> w[N], ans[N], ans_temp;</span><br><span class="line"><span class="type">int</span> siz[N], ma_s[N], col_cnt[N];</span><br><span class="line"><span class="type">int</span> L[N], R[N], dfn[N], cnt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_pre</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l)</span> </span>&#123;</span><br><span class="line">    siz[x] = <span class="number">1</span>, L[x] = ++cnt, dfn[cnt] = x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == l) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs_pre</span>(j, x);</span><br><span class="line">        siz[x] += siz[j];</span><br><span class="line">        <span class="keyword">if</span>(siz[j] &gt; siz[ma_s[x]]) ma_s[x] = j;</span><br><span class="line">    &#125;</span><br><span class="line">    R[x] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">bool</span> keep)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == l || j == ma_s[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(j, x, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ma_s[x]) <span class="built_in">dfs</span>(ma_s[x], x, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(!col_cnt[w[x]]++) ans_temp++;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == l || j == ma_s[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k = L[j]; k &lt;= R[j]; k++) <span class="keyword">if</span>(!col_cnt[w[dfn[k]]]++) ans_temp++;</span><br><span class="line">    &#125;</span><br><span class="line">    ans[x] = ans_temp;</span><br><span class="line">    <span class="keyword">if</span>(!keep) <span class="keyword">for</span>(<span class="type">int</span> i = L[x]; i &lt;= R[x]; i++) <span class="keyword">if</span>(!--col_cnt[w[dfn[i]]]) ans_temp--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="树分块"><a href="#树分块" class="headerlink" title="树分块"></a>树分块</h3><blockquote>
<p>目前我只掌握了<a target="_blank" rel="noopener" href="https://www.cnblogs.com/MeteorFlower/p/top_cluster.html">理论</a></p>
</blockquote>
<hr>
<p>&nbsp;</p>
<h2 id="图"><a href="#图" class="headerlink" title="图"></a>图</h2><h3 id="Bases-4"><a href="#Bases-4" class="headerlink" title="Bases"></a>Bases</h3><ul>
<li>链式前向星。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> h[N], e[M], v[M], ca[M], ne[M], idx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;e[idx] = b, ne[idx] = h[a], h[a] = idx++;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    e[idx] = b, v[idx] = c, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    e[idx] = b, ca[idx] = c, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">    e[idx] = a, ca[idx] = <span class="number">0</span>, ne[idx] = h[b], h[b] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c, <span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">    e[idx] = b, ca[idx] = c, v[idx] = d, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">    e[idx] = a, ca[idx] = <span class="number">0</span>, v[idx] = -d, ne[idx] = h[b], h[b] = idx++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="最短路"><a href="#最短路" class="headerlink" title="最短路"></a>最短路</h3><ul>
<li>Dijkstra 算法，要求不含负权边。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> id, dis;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Node &amp; a, <span class="type">const</span> Node &amp; b) &#123;<span class="keyword">return</span> a.dis &gt; b.dis;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> dis[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dij</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span> vis);</span><br><span class="line">    <span class="built_in">memset</span>(dis, <span class="number">63</span>, <span class="keyword">sizeof</span> dis);</span><br><span class="line">    priority_queue&lt;Node&gt; q;</span><br><span class="line">    dis[s] = <span class="number">0</span>, q.<span class="built_in">push</span>(&#123;s, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> x = q.<span class="built_in">top</span>().id;</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(vis[x]) <span class="keyword">continue</span>;</span><br><span class="line">        vis[x] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(dis[x] + v[i] &lt; dis[j]) &#123;</span><br><span class="line">                dis[j] = dis[x] + v[i];</span><br><span class="line">                q.<span class="built_in">push</span>(&#123;j, dis[j]&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>关于 SPFA，它活的好好的。SPFA 的一个重要用途：找正&#x2F;负环。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> dis[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SPFA</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dis, <span class="number">63</span>, <span class="keyword">sizeof</span> dis);</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    dis[s] = <span class="number">0</span>, q.<span class="built_in">push</span>(s), vis[s] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> x = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>(), vis[x] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(dis[j] &gt; dis[x] + v[i]) &#123;</span><br><span class="line">                dis[j] = dis[x] + v[i];</span><br><span class="line">                <span class="keyword">if</span>(!vis[j]) q.<span class="built_in">push</span>(j), vis[j] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Floyd 全源最短路，还可以做传递闭包。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> f[N][N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">floyd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(f, <span class="number">63</span>, <span class="keyword">sizeof</span> f);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">1</span>; x &lt;= n; x++) &#123;</span><br><span class="line">        f[x][x] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) f[x][e[i]] = v[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; k++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">        f[i][j] = <span class="built_in">min</span>(f[i][j], f[i][k] + f[k][j]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/99802850">Johnson 全源最短路</a>，这个主要学它的思想，在费用流 PD 原始对偶算法中用到。</p>
</li>
<li><p>次短路：依次删原最短路的边再跑最短路，严格次短再加个特判，没什么好说的。</p>
</li>
<li><p>最短路 + <a target="_blank" rel="noopener" href="https://justpureh2o.cn/articles/9131/">分层图建模</a>，当点&#x2F;边的状态会变时（也可能是“人”会变，<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1073">例</a>如“人”买入的状态），一般往分层图去考虑。</p>
</li>
</ul>
<hr>
<h3 id="强连通"><a href="#强连通" class="headerlink" title="强连通"></a>强连通</h3><ul>
<li>Tarjan，这个名字会出现三次（甚至更多）。<br>关于缩点：前提是不论我们如何进入环，都能得到环中的最优解并且能从任意点出环（从点与点关系的角度来说，即环中点的关系是平等的）。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; bl[N];</span><br><span class="line"><span class="type">int</span> bl_cnt;</span><br><span class="line"><span class="type">int</span> dfn[N], low[N], cnt;</span><br><span class="line"><span class="type">bool</span> flag[N];</span><br><span class="line">stack&lt;<span class="type">int</span>&gt; S;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    S.<span class="built_in">push</span>(x), flag[x] = <span class="number">1</span>;</span><br><span class="line">    dfn[x] = low[x] = ++cnt;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(!dfn[j]) <span class="built_in">tarjan</span>(j), low[x] = <span class="built_in">min</span>(low[x], low[j]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(flag[j]) low[x] = <span class="built_in">min</span>(low[x], dfn[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dfn[x] == low[x]) &#123;</span><br><span class="line">        bl_cnt++;</span><br><span class="line">        bl[bl_cnt].<span class="built_in">push_back</span>(x);</span><br><span class="line">        <span class="keyword">while</span>(S.<span class="built_in">top</span>() != x) &#123;</span><br><span class="line">            bl[bl_cnt].<span class="built_in">push_back</span>(S.<span class="built_in">top</span>());</span><br><span class="line">            flag[S.<span class="built_in">top</span>()] = <span class="number">0</span>, S.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        S.<span class="built_in">pop</span>(), flag[x] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="双连通"><a href="#双连通" class="headerlink" title="双连通"></a><a href="https://ewig-milan.github.io/2025/04/29/%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%20%E3%81%AE%20%E4%B8%AA%E4%BA%BA%E6%A0%87%E7%A0%81/">双连通</a></h3><ul>
<li>边双，<del>也是安利上自己的博客了</del>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; ebl[N], ecut;</span><br><span class="line"><span class="type">int</span> ebl_cnt;</span><br><span class="line"><span class="type">int</span> dfn[N], low[N], cnt;</span><br><span class="line">stack&lt;<span class="type">int</span>&gt; S;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l)</span> </span>&#123;</span><br><span class="line">    S.<span class="built_in">push</span>(x);</span><br><span class="line">    dfn[x] = low[x] = ++cnt;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>((i ^ <span class="number">1</span>) == l) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[j]) <span class="built_in">tarjan</span>(j, i), low[x] = <span class="built_in">min</span>(low[x], low[j]);</span><br><span class="line">        <span class="keyword">else</span> low[x] = <span class="built_in">min</span>(low[x], dfn[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dfn[x] == low[x]) &#123;</span><br><span class="line">        ebl_cnt++;</span><br><span class="line">        <span class="keyword">if</span>(l &gt;= <span class="number">0</span>) ecut.<span class="built_in">push_back</span>(l), ecut.<span class="built_in">push_back</span>(l ^ <span class="number">1</span>);</span><br><span class="line">        ebl[ebl_cnt].<span class="built_in">push_back</span>(x);</span><br><span class="line">        <span class="keyword">while</span>(S.<span class="built_in">top</span>() != x) &#123;</span><br><span class="line">            ebl[ebl_cnt].<span class="built_in">push_back</span>(S.<span class="built_in">top</span>());</span><br><span class="line">            S.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        S.<span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ul>
<li>更难的点双。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; pbl[N], pcut;</span><br><span class="line"><span class="type">int</span> pbl_cnt;</span><br><span class="line"><span class="type">int</span> dfn[N], low[N], cnt;</span><br><span class="line">stack&lt;<span class="type">int</span>&gt; S;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l)</span> </span>&#123;</span><br><span class="line">    S.<span class="built_in">push</span>(x);</span><br><span class="line">    dfn[x] = low[x] = ++cnt;</span><br><span class="line">    <span class="type">int</span> son = <span class="number">0</span>; <span class="type">bool</span> cut = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>((i ^ <span class="number">1</span>) == l) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[j]) &#123;</span><br><span class="line">            <span class="built_in">tarjan</span>(j, i);</span><br><span class="line">            <span class="keyword">if</span>(dfn[x] &lt;= low[j]) &#123;</span><br><span class="line">                cut = <span class="literal">true</span>, son++;</span><br><span class="line">                pbl_cnt++;</span><br><span class="line">                pbl[pbl_cnt].<span class="built_in">push_back</span>(x);</span><br><span class="line">                pbl[pbl_cnt].<span class="built_in">push_back</span>(j);</span><br><span class="line">                <span class="keyword">while</span>(S.<span class="built_in">top</span>() != j) &#123;</span><br><span class="line">                    pbl[pbl_cnt].<span class="built_in">push_back</span>(S.<span class="built_in">top</span>());</span><br><span class="line">                    S.<span class="built_in">pop</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                S.<span class="built_in">pop</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            low[x] = <span class="built_in">min</span>(low[x], low[j]);</span><br><span class="line">        &#125; <span class="keyword">else</span> low[x] = <span class="built_in">min</span>(low[x], dfn[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(l == <span class="number">-1</span> &amp;&amp; !son) pbl[++pbl_cnt].<span class="built_in">push_back</span>(x); <span class="comment">// 特判孤立点 非必要别写</span></span><br><span class="line">    <span class="keyword">if</span>(cut &amp;&amp; (l &gt;= <span class="number">0</span> || son &gt; <span class="number">1</span>)) pcut.<span class="built_in">push_back</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="K-短路"><a href="#K-短路" class="headerlink" title="K 短路"></a>K 短路</h3><ul>
<li><strong>A</strong>* 算法（优化搜索算法）。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> r_dis[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AsNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> id, dis;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> AsNode &amp; a, <span class="type">const</span> AsNode &amp; b) &#123;</span><br><span class="line">        <span class="keyword">return</span> a.dis + r_dis[a.id] &gt; b.dis + r_dis[a.id];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">A_star</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">r_dji</span>(n); <span class="comment">// 在 r_mp 上做</span></span><br><span class="line">    priority_queue&lt;AsNode&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(&#123;s, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> x = q.<span class="built_in">top</span>().id, dis = q.<span class="built_in">top</span>().dis;</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(x == n) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, dis);</span><br><span class="line">            <span class="keyword">if</span>(!--k) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = mp.h[x]; ~i; i = mp.ne[i]) &#123;</span><br><span class="line">            <span class="type">int</span> j = mp.e[i];</span><br><span class="line">            q.<span class="built_in">push</span>(&#123;j, dis + mp.v[i]&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(k--) <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ul>
<li>可持久化可并堆（左偏树）做法。关于这个数据结构，由于我<del>不会</del>.暂时用不到，所以未加入数据结构板块。<blockquote>
<p>你以为我<a target="_blank" rel="noopener" href="https://oi-wiki.org/graph/kth-path/#%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E5%8F%AF%E5%B9%B6%E5%A0%86%E4%BC%98%E5%8C%96-k-%E7%9F%AD%E8%B7%AF%E7%AE%97%E6%B3%95">会</a>吗</p>
</blockquote>
</li>
</ul>
<hr>
<h3 id="差分约束"><a href="#差分约束" class="headerlink" title="差分约束"></a>差分约束</h3><ul>
<li><p>对于边 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mi>x</mi></mpadded></mover><mi>b</mi></mrow><annotation encoding="application/x-tex">a\xrightarrow{x}b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9344em;vertical-align:-0.011em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9234em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span> 构成的图 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>→</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">S\to T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>：<br>若其限制条件为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>+</mo><mi>x</mi><mo>≥</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a+x\geq b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span>，则有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>max</mi><mo>⁡</mo></msub><mo>=</mo><mi>S</mi><mo>+</mo><mi>m</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>i</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">T_{\max}=S+mindist</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">min</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span></span></span></span>。<br>若其限制条件为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>+</mo><mi>x</mi><mo>≤</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a+x\leq b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span>，则有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>min</mi><mo>⁡</mo></msub><mo>=</mo><mi>S</mi><mo>+</mo><mi>m</mi><mi>a</mi><mi>x</mi><mi>d</mi><mi>i</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">T_{\min}=S+maxdist</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3175em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">i</span><span class="mtight">n</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span></span></span></span>。</p>
</li>
<li><p>计算方法在上面，核心代码与 SPFA 就差了三行，旨在用“最长松弛路径”判正&#x2F;负环。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> len[N]; <span class="comment">// len[i] 表示到 i 点的最长松弛路径的长度</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 放在 “if 可以松弛” 里面</span></span><br><span class="line">len[j] = <span class="built_in">max</span>(len[j], len[x] + <span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(len[j] &gt;= n) <span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="基环树"><a href="#基环树" class="headerlink" title="基环树"></a>基环树</h3><blockquote>
<p><del>这个东西应该放到 DP 部分的</del></p>
</blockquote>
<ul>
<li><a href="https://ewig-milan.github.io/2025/05/07/%E5%9F%BA%E7%8E%AF%E6%A0%91%20%E3%81%AE%20%E7%A7%91%E7%A0%94%20%E4%B9%8B%20%E6%89%BE%E7%8E%AF/">找环</a>，对环上点做树形 DP（或树上其他问题，<del>加点分治那就是纯毒瘤</del>），然后在环上想方设法统计答案（不一定是 DP）。下放简单找环代码，用 Tarjan 找环也无所谓。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; cir;</span><br><span class="line"><span class="type">bool</span> in_cir[N];</span><br><span class="line"><span class="type">int</span> pa[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">find_cir</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) <span class="keyword">if</span>((i ^ <span class="number">1</span>) != l) <span class="keyword">if</span>(pa[e[i]] &amp;&amp; cir.<span class="built_in">empty</span>())</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> t = x; t != pa[e[i]]; t = pa[t]) cir.<span class="built_in">push_back</span>(t), in_cir[t] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(!pa[e[i]]) pa[e[i]] = x, <span class="built_in">find_cir</span>(e[i], i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main 里处理基环树森林</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="keyword">if</span>(!pa[i]) &#123;</span><br><span class="line">    pa[i] = <span class="number">-1</span>, <span class="built_in">find_cir</span>(i, <span class="number">-1</span>);</span><br><span class="line">   <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="最小生成树"><a href="#最小生成树" class="headerlink" title="最小生成树"></a>最小生成树</h3><ul>
<li>Kruskal 算法，我常用这个。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">    <span class="type">int</span> a, b, v, id;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Edge &amp; a, <span class="type">const</span> Edge &amp; b) &#123;<span class="keyword">return</span> a.v &lt; b.v;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">vector&lt;Edge&gt; E;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">krus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">sort</span>(E.<span class="built_in">begin</span>(), E.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">for</span>(Edge i : E) <span class="keyword">if</span>(<span class="built_in">merge</span>(i.a, i.b))</span><br><span class="line">        res += i.v, <span class="built_in">add</span>(i.a, i.b, i.v);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/liuchanglc/p/14199819.html">Prim 算法 &amp; Boruvka 算法</a>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/">（严格）次小生成树</a>：思想是挨个加边，在产生的环上删最大边（严格次小生成树还要删严格次大边），这一步倍增解决<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/216408466">。</a></p>
</li>
</ul>
<hr>
<h3 id="欧拉（回）路"><a href="#欧拉（回）路" class="headerlink" title="欧拉（回）路"></a>欧拉（回）路</h3><ul>
<li>一定要注意<strong>当前弧优化</strong>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = h[x]) &#123;</span><br><span class="line">    h[x] = ne[i];</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://oi-wiki.org/graph/euler/">无需多言</a>，题目中，注意“整个城市所有的道路都是双向车道,道路的两个方向均需要…”等字眼。</li>
</ul>
<hr>
<h3 id="二分图"><a href="#二分图" class="headerlink" title="二分图"></a>二分图</h3><ul>
<li><p>最大匹配 &#x3D; 最小点覆盖 &#x3D; 总点数 - 最大独立集 &#x3D; 总点数 - <a target="_blank" rel="noopener" href="https://www.acwing.com/file_system/file/content/whole/index/content/159305/">（建模后的）最小路径（不可交）点覆盖</a>（1:57），同时，最小路径<strong>重复</strong>（路径可交）点覆盖 &#x3D; 传递闭包后做最小路径（不可交）点覆盖。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://justpureh2o.cn/articles/21386/#%E5%85%B8%E4%BE%8B">建模典例</a>。</p>
</li>
<li><p>建议忘记匈牙利算法。</p>
</li>
</ul>
<hr>
<p>&nbsp;</p>
<h2 id="网络流"><a href="#网络流" class="headerlink" title="网络流"></a>网络流</h2><h3 id="Bases-5"><a href="#Bases-5" class="headerlink" title="Bases"></a>Bases</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/EQUINOX1/article/details/135721964">基本概念</a>。</p>
</li>
<li><p>核心拿出来了：最大流 &#x3D; 最小割 &#x3D; <strong>没有增广路</strong>。</p>
</li>
</ul>
<hr>
<h3 id="最大流"><a href="#最大流" class="headerlink" title="最大流"></a>最大流</h3><ul>
<li>我只用 Dinic。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> dep[N], can[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dep, <span class="number">-1</span>, <span class="keyword">sizeof</span> dep);</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    dep[s] = <span class="number">0</span>, q.<span class="built_in">push</span>(s);</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> x = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        can[x] = h[x];</span><br><span class="line">        <span class="keyword">if</span>(x == t) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(dep[j] == <span class="number">-1</span> &amp;&amp; ca[i]) dep[j] = dep[x] + <span class="number">1</span>, q.<span class="built_in">push</span>(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, ll lim)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x == t) <span class="keyword">return</span> lim;</span><br><span class="line">    ll flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = can[x]; ~i &amp;&amp; flow &lt; lim; i = ne[i]) &#123;</span><br><span class="line">        can[x] = i;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(dep[j] == dep[x] + <span class="number">1</span> &amp;&amp; ca[i]) &#123;</span><br><span class="line">            ll tmp = <span class="built_in">dfs</span>(j, <span class="built_in">min</span>(ca[i], lim - flow));</span><br><span class="line">            <span class="keyword">if</span>(!tmp) dep[j] = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">else</span> flow += tmp, ca[i] -= tmp, ca[i ^ <span class="number">1</span>] += tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">dinic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ll mf = <span class="number">0</span>, tmp;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">bfs</span>()) <span class="keyword">while</span>(tmp = <span class="built_in">dfs</span>(s, INF)) mf += tmp;</span><br><span class="line">    <span class="keyword">return</span> mf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="费用流"><a href="#费用流" class="headerlink" title="费用流"></a>费用流</h3><ul>
<li>SSP + Dinic 算法，但——关于 SPFA，它濒死了。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> dis[N], can[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">SPFA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) dis[i] = INF;</span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span> vis);</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    dis[S] = <span class="number">0</span>, vis[S] = <span class="number">1</span>;</span><br><span class="line">    q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> x = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>(), vis[x] = <span class="number">0</span>;</span><br><span class="line">        can[x] = h[x];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(ca[i] &amp;&amp; dis[j] &gt; dis[x] + v[i]) &#123;</span><br><span class="line">                dis[j] = dis[x] + v[i];</span><br><span class="line">                <span class="keyword">if</span>(!vis[j]) q.<span class="built_in">push</span>(j), vis[j] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dis[T] &lt; INF;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> lim)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x == T) <span class="keyword">return</span> lim;</span><br><span class="line">    vis[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> &amp;i = can[x]; ~i &amp;&amp; flow &lt; lim; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(dis[j] == dis[x] + v[i] &amp;&amp; ca[i] &amp;&amp; !vis[j]) &#123;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">dfs</span>(j, <span class="built_in">min</span>(ca[i], lim - flow));</span><br><span class="line">            <span class="keyword">if</span>(!tmp) dis[j] = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">else</span> flow += tmp, ca[i] -= tmp, ca[i ^ <span class="number">1</span>] += tmp, cost += v[i] * tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    vis[x] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dinic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> mf = <span class="number">0</span>, tmp;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">SPFA</span>()) <span class="keyword">while</span>(tmp = <span class="built_in">dfs</span>(S, INF)) mf += tmp;</span><br><span class="line">    <span class="keyword">return</span> mf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Primal-Dual 原始对偶算法，关于 Johnson 算法，它在上面。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> pe[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SPFA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(pe, <span class="number">63</span>, <span class="keyword">sizeof</span> pe);</span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span> vis);</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    pe[S] = <span class="number">0</span>, q.<span class="built_in">push</span>(S), vis[S] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> x = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>(), vis[x] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(ca[i] &amp;&amp; pe[j] &gt; pe[x] + v[i]) &#123;</span><br><span class="line">                pe[j] = pe[x] + v[i];</span><br><span class="line">                <span class="keyword">if</span>(!vis[j]) q.<span class="built_in">push</span>(j), vis[j] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> dis, id;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Node &amp; a, <span class="type">const</span> Node &amp; b) &#123;<span class="keyword">return</span> a.dis &gt; b.dis;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> dis[N], can[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dij</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) dis[i] = INF, vis[i] = <span class="number">0</span>, can[i] = h[i];</span><br><span class="line">    priority_queue&lt;Node&gt; q;</span><br><span class="line">    dis[S] = <span class="number">0</span>, q.<span class="built_in">push</span>(&#123;<span class="number">0</span>, S&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> x = q.<span class="built_in">top</span>().id;</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(vis[x]) <span class="keyword">continue</span>;</span><br><span class="line">        vis[x] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = h[x]; ~i; i = ne[i]) &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(ca[i] &amp;&amp; dis[j] &gt; dis[x] + v[i] + pe[x] - pe[j]) &#123;</span><br><span class="line">                dis[j] = dis[x] + v[i] + pe[x] - pe[j];</span><br><span class="line">                q.<span class="built_in">push</span>(&#123;dis[j], j&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span> vis);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) pe[i] += dis[i]; <span class="comment">// 这是个大坑 有的时候会碰不到 T (或其他点) 特别难调!!!</span></span><br><span class="line">    <span class="keyword">return</span> dis[T] &lt; INF;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> lim)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x == T) <span class="keyword">return</span> lim;</span><br><span class="line">    vis[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> &amp;i = can[x]; ~i &amp;&amp; flow &lt; lim; i = ne[i]) &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(v[i] + pe[x] - pe[j] == <span class="number">0</span> &amp;&amp; !vis[j] &amp;&amp; ca[i]) &#123;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">dfs</span>(j, <span class="built_in">min</span>(ca[i], lim - flow));</span><br><span class="line">            <span class="keyword">if</span>(!tmp) vis[j] = <span class="number">1</span>; <span class="comment">// 此处写法正确性已验证</span></span><br><span class="line">            <span class="keyword">else</span> flow += tmp, ca[i] -= tmp, ca[i ^ <span class="number">1</span>] += tmp, cost += tmp * v[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    vis[x] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">PD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cost = <span class="number">0</span>, <span class="built_in">SPFA</span>();</span><br><span class="line">    <span class="type">int</span> mf = <span class="number">0</span>, tmp;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">dij</span>()) <span class="keyword">while</span>(tmp = <span class="built_in">dfs</span>(S, INF)) mf += tmp;</span><br><span class="line">    <span class="keyword">return</span> mf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="典例"><a href="#典例" class="headerlink" title="典例"></a>典例</h3><ul>
<li><p>关于网络流的典例那就不得不单独开一块了。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.acwing.com/activity/content/32/">建模得到更复杂的板子</a>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/list?type=luogu&page=1&tag=332">24 题</a>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/article/2lmd8k67">一些思考 &amp; 总结</a>。</p>
</li>
</ul>
<hr>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h1><h2 id="DP-部分"><a href="#DP-部分" class="headerlink" title="DP 部分"></a>DP 部分</h2><h3 id="Bases-6"><a href="#Bases-6" class="headerlink" title="Bases"></a>Bases</h3><ul>
<li><p>首先我们要知道 DP 绝对没有所谓的“模板”。但对于一般性的 DP 问题可以有一个固定的思维方向：状态 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span> 阶段 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span> 转移。</p>
<ul>
<li><p><strong>状态</strong>：遇到一个陌生情境时一定不能吝啬你给它安排的状态，因为往往没思路的原因就是“状态少了，无法清晰地转移”。<strong>但就算状态多，各个状态也要清晰、简易！（这能简化转移式、提升正确率、加快做题速度，也别忘了去除无用状态）</strong></p>
</li>
<li><p>阶段：这一部分要想清楚子问题间的依赖关系，不仅要无后效性，还不能漏掉可行决策。</p>
</li>
<li><p><strong>转移</strong>：写方程时要细心，或者直接手推小样例检验自己的转移方程，注意转移的先后顺序。</p>
</li>
<li><p>还要学会一点：看数据范围判断算法（矩乘，状压…）。</p>
</li>
</ul>
</li>
<li><p>关于转移：摒弃<strong>过于宽泛</strong>的转移，因其有如下问题：</p>
<ul>
<li><p>转移方程过于复杂，浪费时间。</p>
</li>
<li><p>决策数过多，或是对子问题的重复计算，使算法效率严重下降。</p>
</li>
<li><p>冗余、<strong>不优</strong>的决策仍被考虑（这些决策本应被剪去不考虑）。</p>
</li>
</ul>
<p>  针对前两点，要限定可转移的范围。一个实用的方法是，先尽可能压缩范围，有漏掉的再加。给一些例子：从“往前<strong>一个</strong>单词处”转移、仅枚举<strong>上一个</strong>区域转移、从“拿这<strong>一个</strong>物品前”转移…<br>针对第三点，带着“优化决策数”的目的多思考就行。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/luckyblock/p/13121167.html">题目</a>。</p>
</li>
</ul>
<hr>
<h3 id="一题一类"><a href="#一题一类" class="headerlink" title="一题一类"></a>一题一类</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P10971">线性 DP</a>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1775">区间 DP</a>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P6064">环形 DP</a>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2014">树形 DP</a>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P10974">换根 DP</a>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF24D">概率&#x2F;期望 DP</a>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3959">状压 DP</a>。</p>
</li>
<li><p><a href="https://ewig-milan.github.io/2025/06/13/%E6%8F%92%E5%A4%B4DP%20-%20%E5%93%88%E5%AF%86%E9%A1%BF%E5%9B%9E%E8%B7%AF%E8%AE%A1%E6%95%B0/">插头 DP</a>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P7690">计数 DP</a>。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P10959">数位 DP</a>。</p>
</li>
</ul>
<hr>
<h3 id="背包问题"><a href="#背包问题" class="headerlink" title="背包问题"></a>背包问题</h3><ul>
<li><a target="_blank" rel="noopener" href="https://oi-wiki.org/dp/knapsack/">杂，但模板化</a>。</li>
</ul>
<hr>
<p>&nbsp;</p>
<h2 id="优化部分"><a href="#优化部分" class="headerlink" title="优化部分"></a>优化部分</h2><h3 id="记忆化搜索"><a href="#记忆化搜索" class="headerlink" title="记忆化搜索"></a>记忆化搜索</h3><blockquote>
<p>严格来讲这是一个写法上的优化</p>
</blockquote>
<ul>
<li><p>记忆化搜索的核心是 DFS，其优点在于简化了复杂的“枚举顺序”，尤其是对于多函数的转移方程而言。但注意，记忆化搜索的空间目前无法优化，小心爆空间。</p>
</li>
<li><p>期望 DP 是一个神奇的东西，因为“期望”在递推终点才有确定性，所以常用记忆化。</p>
</li>
</ul>
<hr>
<h3 id="启发式优化"><a href="#启发式优化" class="headerlink" title="启发式优化"></a>启发式优化</h3><ul>
<li>发现决策集合可以单调不减时，单变量维护最优决策 ，<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/article/gzxxlblu">例</a>。</li>
</ul>
<hr>
<h3 id="单调队列优化"><a href="#单调队列优化" class="headerlink" title="单调队列优化"></a>单调队列优化</h3><ul>
<li>首先必然是<a target="_blank" rel="noopener" href="https://www.acwing.com/solution/content/53507/">多重背包</a>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> wei[N], val[N], hav[N];</span><br><span class="line">deque&lt;<span class="type">int</span>&gt; q;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; wei[i]; j++) &#123;</span><br><span class="line">        q.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">0</span>; x * wei[i] + j &lt;= V; x++) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!q.<span class="built_in">empty</span>() &amp;&amp; x - q.<span class="built_in">front</span>() &gt; hav[i]) q.<span class="built_in">pop_front</span>();</span><br><span class="line">            <span class="keyword">while</span>(!q.<span class="built_in">empty</span>() &amp;&amp; f[i - <span class="number">1</span>][j + x * wei[i]] &gt;= f[i - <span class="number">1</span>][j + q.<span class="built_in">back</span>() * wei[i]] + (x - q.<span class="built_in">back</span>()) * val[i]) q.<span class="built_in">pop_back</span>();</span><br><span class="line">            q.<span class="built_in">push_back</span>(x);</span><br><span class="line">            f[i][j + x * wei[i]] = f[i - <span class="number">1</span>][j + q.<span class="built_in">front</span>() * wei[i]] + (x - q.<span class="built_in">front</span>()) * val[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/solution/CF372C">一题一类</a>。</li>
</ul>
<hr>
<h3 id="四边形不等式优化"><a href="#四边形不等式优化" class="headerlink" title="四边形不等式优化"></a>四边形不等式优化</h3><ul>
<li>一维情况：若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mrow><mi>min</mi><mo>⁡</mo></mrow><mrow><mn>1</mn><mo>≤</mo><mi>j</mi><mo>&lt;</mo><mi>i</mi></mrow></munder><mi>w</mi><mo stretchy="false">(</mo><mi>j</mi><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(i) = \min\limits_{1 \leq j &lt; i} w(j, i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.6138em;vertical-align:-0.8638em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-2.3723em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mrel mtight">≤</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">min</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8638em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span> 中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> 函数满足<a target="_blank" rel="noopener" href="https://oi-wiki.org/dp/opt/quadrangle/">四边形不等式</a>（简记：交叉小于等于包含），则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> 具有决策单调性，体现如下（这里仅针对 a、b 讨论优劣，其具有普遍性，可推广）：<img src="https://cdn.luogu.com.cn/upload/image_hosting/s4ysiapx.png"></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// F(i, j) 指：由 f[j] 转移得到的 f[i] 的值</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">P</span> &#123;<span class="type">int</span> l, r, p;&#125;;</span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">work</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    deque&lt;P&gt; q;</span><br><span class="line">    q.<span class="built_in">push_back</span>(&#123;<span class="number">1</span>, n, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span>(q.<span class="built_in">front</span>().r &lt; i) q.<span class="built_in">pop_front</span>();</span><br><span class="line">        f[i] = <span class="built_in">F</span>(i, q.<span class="built_in">front</span>().p);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">F</span>(n, q.<span class="built_in">back</span>().p) &lt; <span class="built_in">F</span>(n, i)) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">while</span>(q.<span class="built_in">back</span>().l &gt; i &amp;&amp; <span class="built_in">F</span>(q.<span class="built_in">back</span>().l, i) &lt;= <span class="built_in">F</span>(q.<span class="built_in">back</span>().l, q.<span class="built_in">back</span>().p)) q.<span class="built_in">pop_back</span>();</span><br><span class="line">        <span class="comment">// 被全部覆盖的直接删掉</span></span><br><span class="line">        P &amp; bk = q.<span class="built_in">back</span>();</span><br><span class="line">        <span class="type">int</span> l = bk.l, r = bk.r;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r) &#123;</span><br><span class="line">            <span class="type">int</span> mid = l + r + <span class="number">1</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">F</span>(mid, bk.p) &lt; <span class="built_in">F</span>(mid, i)) l = mid;</span><br><span class="line">            <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        bk.r = l;</span><br><span class="line">        q.<span class="built_in">push_back</span>(&#123;l + <span class="number">1</span>, n, i&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, f[n]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>二维情况：若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mrow><mi>min</mi><mo>⁡</mo></mrow><mrow><mi>i</mi><mo>≤</mo><mi>k</mi><mo>&lt;</mo><mi>j</mi></mrow></munder><mi>f</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>k</mi><mo stretchy="false">)</mo><mo>+</mo><mi>f</mi><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>+</mo><mi>w</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(i, j) = \min\limits_{i \leq k &lt; j} f(i, k) + f(k+1, j) + w(i, j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.6382em;vertical-align:-0.8882em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-2.3479em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">≤</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">min</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8882em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span> 中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> 函数满足四边形不等式和<a target="_blank" rel="noopener" href="https://oi-wiki.org/dp/opt/quadrangle/#%E5%8C%BA%E9%97%B4%E5%90%88%E5%B9%B6%E9%97%AE%E9%A2%98">区间包含单调性</a>（简记：大于等于任何子区间），则最优分割点的关系：<img src="https://cdn.luogu.com.cn/upload/image_hosting/u4ze4gmz.png"></li>
</ul>
<hr>
<h3 id="斜率优化"><a href="#斜率优化" class="headerlink" title="斜率优化"></a>斜率优化</h3><ul>
<li>这个懒的<a target="_blank" rel="noopener" href="https://oi-wiki.org/dp/opt/slope/">细讲</a>，因为斜率优化有<a href="https://ewig-milan.github.io/2025/05/22/%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96%20%E3%81%AE%20%E4%BB%A3%E7%A0%81%E6%95%B4%E5%90%88/">板子</a>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PLL pair<span class="string">&lt;ll, ll&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> x first</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> y second</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">300100</span>;</span><br><span class="line"><span class="type">const</span> PLL O = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">ll C[N], T[N], f[N], S;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; cvh; <span class="comment">//convex hull</span></span><br><span class="line"><span class="type">int</span> l, r = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">X</span><span class="params">(<span class="type">int</span> j)</span> </span>&#123;<span class="keyword">return</span> C[j];&#125;</span><br><span class="line"><span class="function">ll <span class="title">Y</span><span class="params">(<span class="type">int</span> j)</span> </span>&#123;<span class="keyword">return</span> f[j];&#125;</span><br><span class="line"><span class="function">ll <span class="title">F</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> </span>&#123;<span class="keyword">return</span> f[j] - (S + T[i]) * C[j] + S * C[n] + T[i] * C[i];&#125;</span><br><span class="line"><span class="comment">// 以上三个是随题变化的</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 若改成 &lt;= 维护上凸壳</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp_k</span><span class="params">(PLL a, PLL b, PLL c, PLL d)</span> </span>&#123; <span class="comment">// k(ab) &gt;= k(cd)</span></span><br><span class="line">    <span class="keyword">return</span> (__int128)(b.y - a.y) * (d.x - c.x)</span><br><span class="line">    &gt;= (__int128)(b.x - a.x) * (d.y - c.y);</span><br><span class="line">&#125; <span class="comment">// 带不带这个等号 关联的其实是一个常数问题 影响不大</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------- 除法形式 容易爆精度 还容易爆除以0</span></span><br><span class="line"><span class="comment">// bool cmp_k(PLL a, PLL b, PLL c, PLL d) &#123; // 同上</span></span><br><span class="line"><span class="comment">//     return (double)(b.y - a.y) / (b.x - a.x)</span></span><br><span class="line"><span class="comment">//     &gt;= (double)(d.y - c.y) / (d.x - c.x);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这三个完全不用变</span></span><br><span class="line"><span class="function">PLL <span class="title">P</span><span class="params">(<span class="type">int</span> id<span class="comment">/*upd 5.23*/</span>)</span> </span>&#123;<span class="keyword">return</span> &#123;<span class="built_in">X</span>(id), <span class="built_in">Y</span>(id)&#125;;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// O(n)写法 要求 k 单调</span></span><br><span class="line"><span class="comment">// int get_ans(ll k) &#123;</span></span><br><span class="line"><span class="comment">//     while(l &lt; r &amp;&amp; cmp_k(O, &#123;1, k&#125;, P(cvh[l]), P(cvh[l + 1]))) l++;</span></span><br><span class="line"><span class="comment">//     return cvh[l];</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_ans</span><span class="params">(ll k)</span> </span>&#123;</span><br><span class="line">    l = <span class="number">0</span>, r = cvh.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(l &lt; r) &#123;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">Y</span>(cvh[mid]) - k * <span class="built_in">X</span>(cvh[mid]) &lt;=<span class="comment">/*下凸包*/</span></span><br><span class="line">            <span class="built_in">Y</span>(cvh[mid + <span class="number">1</span>]) - k * <span class="built_in">X</span>(cvh[mid + <span class="number">1</span>])) r = mid; <span class="comment">// upd 7.20 黑题有感</span></span><br><span class="line">        <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> tmp = cvh[l];</span><br><span class="line">    l = <span class="number">0</span>, r = cvh.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_back</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(l &lt;= r &amp;&amp; <span class="built_in">X</span>(x) == <span class="built_in">X</span>(cvh[r])) &#123; <span class="comment">// upd 7.20 黑题有感</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">Y</span>(cvh[r]) &gt;= <span class="built_in">Y</span>(x)) r--;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            cvh.<span class="built_in">resize</span>(r + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(l &lt; r &amp;&amp; <span class="built_in">cmp_k</span>(<span class="built_in">P</span>(cvh[r - <span class="number">1</span>]), <span class="built_in">P</span>(x), <span class="built_in">P</span>(cvh[r]), <span class="built_in">P</span>(x))) r--;</span><br><span class="line">    cvh.<span class="built_in">resize</span>(++r), cvh.<span class="built_in">push_back</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main 里面</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// f[0] 初始化，并 add_back(0)   </span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    f[i] = <span class="built_in">F</span>(i, <span class="built_in">get_ans</span>(S + T[i])<span class="comment">/*回传下标*/</span>);</span><br><span class="line">    <span class="built_in">add_back</span>(i); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="矩阵乘方优化（加速递推）"><a href="#矩阵乘方优化（加速递推）" class="headerlink" title="矩阵乘方优化（加速递推）"></a>矩阵乘方优化（加速递推）</h3><ul>
<li><p>代码易写错的前置知识，<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95/5446029">矩阵乘法</a>。</p>
</li>
<li><p>这个算法需要<strong>观察数据范围</strong>，因为他在一个很尴尬的处境中：数据范围小了，没必要用；数据范围大了，一眼就看得出来要用；数据范围卡得<br>“正好要用”，可能常数太大正解过不了。<br>所以大多数都能一眼看出来。</p>
</li>
<li><p>这里给出递推的原理，那么“转移矩阵”的构造方法也一目了然了。<br>假设有当前项四元组 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mtext> </mtext><mi>a</mi><mtext>  </mtext><mi>b</mi><mtext>  </mtext><mi>c</mi><mtext>  </mtext><mi>d</mi><mtext> </mtext><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[~ a~~ b~~ c~~d~]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mspace nobreak"> </span><span class="mord mathnormal">a</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord mathnormal">b</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord mathnormal">c</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord mathnormal">d</span><span class="mspace nobreak"> </span><span class="mclose">]</span></span></span></span>，那么通过转移矩阵得到下一项四元组 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mtext> </mtext><msup><mi>a</mi><mo mathvariant="normal">′</mo></msup><mtext>  </mtext><msup><mi>b</mi><mo mathvariant="normal">′</mo></msup><mtext>  </mtext><msup><mi>c</mi><mo mathvariant="normal">′</mo></msup><mtext>  </mtext><msup><mi>d</mi><mo mathvariant="normal">′</mo></msup><mtext> </mtext><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[~a^\prime~~ b^\prime~~ c^\prime~~d^\prime~]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mclose">]</span></span></span></span> 的（形象化）方式为：四个元竖直排列，再去乘对应的<strong>行</strong>，各<strong>列</strong>求和就是新的四元组，同时可以牢记下方的图。</p>
</li>
</ul>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>c</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>d</mi></mstyle></mtd></mtr></mtable><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mo lspace="0em" rspace="0em">×</mo></mpadded></mover></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋅</mo></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtable rowspacing="0.16em" columnalign="center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>↓</mo><mtext>   </mtext><mo>↓</mo><mtext>   </mtext><mo>↓</mo><mtext>   </mtext><mo>↓</mo></mrow></mstyle></mtd></mtr></mtable></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msup><mi>a</mi><mo mathvariant="normal">′</mo></msup><mtext>  </mtext><msup><mi>b</mi><mo mathvariant="normal">′</mo></msup><mtext>  </mtext><msup><mi>c</mi><mo mathvariant="normal">′</mo></msup><mtext>  </mtext><msup><mi>d</mi><mo mathvariant="normal">′</mo></msup></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{array}{cc}
\begin{array}{c}
a \\ b \\ c \\ d
\end{array}
\xrightarrow{\times}
&amp;
\left[
\begin{array}{cccc}
\cdot &amp; \cdot &amp; \cdot &amp; \cdot \\
\cdot &amp; \cdot &amp; \cdot &amp; \cdot \\
\cdot &amp; \cdot &amp; \cdot &amp; \cdot \\
\cdot &amp; \cdot &amp; \cdot &amp; \cdot \\
\end{array}
\right]
\\
&amp;
\begin{array}{cccc}
\downarrow ~~~ \downarrow ~~~ \downarrow ~~~ \downarrow\\
\end{array}
\\
&amp;
\left[
\begin{array}{cccc}
a^\prime ~~ b^\prime ~~ c^\prime ~~ d ^\prime\\
\end{array}
\right]
\end{array}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.22em;vertical-align:-3.36em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.86em;"><span style="top:-5.86em;"><span class="pstrut" style="height:4.65em;"></span><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">c</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0303em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord mtight">×</span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span></span></span><span style="top:-2.86em;"><span class="pstrut" style="height:4.65em;"></span><span class="mord"></span></span><span style="top:-1.65em;"><span class="pstrut" style="height:4.65em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.36em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.86em;"><span style="top:-5.86em;"><span class="pstrut" style="height:4.65em;"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:6.8em;"></span><span style="width:0.667em;height:4.800em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="4.800em" viewBox="0 0 667 4800"><path d="M403 1759 V84 H666 V0 H319 V1759 v1200 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v1200 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">⋅</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:6.8em;"></span><span style="width:0.667em;height:4.800em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="4.800em" viewBox="0 0 667 4800"><path d="M347 1759 V0 H0 V84 H263 V1759 v1200 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v1200 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-2.86em;"><span class="pstrut" style="height:4.65em;"></span><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">↓</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mrel">↓</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mrel">↓</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mrel">↓</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span><span style="top:-1.65em;"><span class="pstrut" style="height:4.65em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.36em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span>

<hr>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><blockquote>
<p>关于字符串目前涉及较少</p>
</blockquote>
<h2 id="后缀数组"><a href="#后缀数组" class="headerlink" title="后缀数组"></a>后缀数组</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://oi-wiki.org/string/sa/#%E8%BF%87%E7%A8%8B">大体思路</a>，这里避个坑：后缀数组的板子其实<strong>与基数排序没有什么关系</strong>，它运用到的是计数排序的特点：能线性做双关键字排序（具体见下），所以<strong>不要为了基数排序想破脑袋</strong>。</p>
</li>
<li><p>写法方面，研究计数排序（俗称桶排）<code>for(int i = n; i; i--) sa[T[rk[i]]--] = i;</code>以及难以理解的<code>sa[T[rk[se_st[i]]]--] = se_st[i]</code>写法。<br>首先我们知道，它稳定的原因是 i 的倒序枚举与 T[]– 的写法结合，实现了“同 rk 的数，位置在后面的就会先放在后面”。那么其形式化的本质就是将 i（位置）作为第二关键字的排序，那如果我们在这个排序中改变第二关键字为 se_st（具体指什么见上面 link）呢？但在实现中 se_st 数组的下标就是排名，于是我们将 i 替换成 se_st[i]，i 的枚举仍从 n 到 1，至此<code>sa[T[rk[se_st[i]]]--] = se_st[i]</code>写法的意义就十分清晰了。</p>
</li>
<li><p>然后就是 height 相关证明，这个比较<a target="_blank" rel="noopener" href="https://oi-wiki.org/string/sa/#on-%E6%B1%82-height-%E6%95%B0%E7%BB%84%E9%9C%80%E8%A6%81%E7%9A%84%E4%B8%80%E4%B8%AA%E5%BC%95%E7%90%86">简单</a>。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> sa[N], ht[N], rk[N &lt;&lt; <span class="number">1</span>], T[N], rk_cpy[N &lt;&lt; <span class="number">1</span>], se_st[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_SA</span><span class="params">(<span class="type">char</span> s[])</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> m = <span class="number">128</span>, n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) T[rk[i] = s[i]]++;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= m; i++) T[i] += T[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = n; i; i--) sa[T[rk[i]]--] = i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">1</span>, t; k &lt; n; k &lt;&lt;= <span class="number">1</span>, m = t) &#123;</span><br><span class="line">        t = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = n - k + <span class="number">1</span>; i &lt;= n; i++) se_st[++t] = i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            <span class="keyword">if</span>(sa[i] &gt; k) se_st[++t] = sa[i] - k;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; i++) T[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) T[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= m; i++) T[i] += T[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = n; i; i--) sa[T[rk[se_st[i]]]--] = se_st[i];</span><br><span class="line">        <span class="built_in">swap</span>(rk, rk_cpy), t = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(rk_cpy[sa[i]] != rk_cpy[sa[i - <span class="number">1</span>]] || </span><br><span class="line">                rk_cpy[sa[i] + k] != rk_cpy[sa[i - <span class="number">1</span>] + k]) t++;</span><br><span class="line">            rk[sa[i]] = t;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(t == n) <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_ht</span><span class="params">(<span class="type">char</span> s[])</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">    ht[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(rk[i] == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(k) k--;</span><br><span class="line">        <span class="keyword">while</span>(s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k] &amp;&amp; </span><br><span class="line">            i + k &lt;= n &amp;&amp; sa[rk[i] - <span class="number">1</span>] + k &lt;= n) k++;</span><br><span class="line">        ht[rk[i]] = k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>应用方面就大多是基于 ht 数组跑对数或线性级别的算法（求和、二分、倍增…），<a target="_blank" rel="noopener" href="https://51cspnoip.cn/problem/67f4c0274db8107579576c53">典例</a>。</li>
</ul>
<hr>
<p>&nbsp;</p>
<h2 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h2><ul>
<li>算法核心就是它的名字：“<strong>失配</strong>指针”，理解这个名字就能学会这个算法。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> ne[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">KMP</span><span class="params">(<span class="type">char</span> pat[], <span class="type">char</span> txt[])</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(ne, <span class="number">0</span>, <span class="built_in">sizeof</span>(ne));</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> p_n = <span class="built_in">strlen</span>(pat + <span class="number">1</span>), t_n = <span class="built_in">strlen</span>(txt + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>, j = <span class="number">0</span>; i &lt;= p_n; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span>(j &amp;&amp; pat[i] != pat[j + <span class="number">1</span>]) j = ne[j];</span><br><span class="line">        j += pat[i] == pat[j + <span class="number">1</span>];</span><br><span class="line">        ne[i] = j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>, j = <span class="number">0</span>; i &lt;= t_n; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span>(j &amp;&amp; txt[i] != pat[j + <span class="number">1</span>]) j = ne[j];</span><br><span class="line">        j += txt[i] == pat[j + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(j == p_n) res++, j = ne[j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>&nbsp;</p>
<h2 id="AC-自动机"><a href="#AC-自动机" class="headerlink" title="AC 自动机"></a>AC 自动机</h2><ul>
<li>本质是图（树）上的 KMP，关于<a target="_blank" rel="noopener" href="https://oi-wiki.org/string/ac-automaton/#%E5%A4%B1%E9%85%8D%E6%8C%87%E9%92%88">不同</a>，并且 AC 自动机的失配指针是满树的（称作 Trie 图），即所有失配情况一次就能跳到（为方便，空孩子直接接向<strong>对应字母</strong>的失配点），详见代码。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> tr[N][<span class="number">26</span>], ne[N], cnt[N], idx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> s[])</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> s_n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= s_n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!tr[j][s[i] - <span class="string">&#x27;a&#x27;</span>]) tr[j][s[i] - <span class="string">&#x27;a&#x27;</span>] = ++idx;</span><br><span class="line">        j = tr[j][s[i] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    cnt[j]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)</span><br><span class="line">        <span class="keyword">if</span>(tr[<span class="number">0</span>][i]) q.<span class="built_in">push</span>(tr[<span class="number">0</span>][i]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> j = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> k = tr[j][i];</span><br><span class="line">            <span class="keyword">if</span>(k) ne[k] = tr[ne[j]][i], q.<span class="built_in">push</span>(k);</span><br><span class="line">            <span class="keyword">else</span> tr[j][i] = tr[ne[j]][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Fail 树子树权值和就是此点代表的模式串的匹配量，所以文本串匹配的一般方式是：走一遍 Trie 图，经过的点点权加 1，再对每个<strong>模式串代表点</strong>求子树和。</p>
</li>
<li><p>“是否出现、出现过几种等”单模式串在<strong>各个文本串</strong>中仅能匹配一遍的题（有可能是多个文本串），在文本串走 Trie 图加点权时，（DFS 序上）每相邻两点间的 LCA 点权减 1（这个的写法看这<a target="_blank" rel="noopener" href="https://51cspnoip.cn/problem/67ff032d4db810757978c9ba">题</a>）。</p>
</li>
<li><p>Trie 图上 DP 的常见状态：文本串匹配了多长、匹配到的 Trie 图节点在哪…</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4052">有的题</a>，你 DP（或做其它算法）时<strong>不允许匹配出</strong>某些模式串，那么你做了一个 barrier 数组，于是这里有一个细节：在 Fail 树上，一个封禁节点的子树 bar 值应全为 1（或 0，看你的定义了），于是 build 时：<code>if(k) ne[k] = tr[ne[j]][i], q.push(k), bar[k] |= bar[ne[k]];</code>。</p>
</li>
</ul>
<hr>
<p>&nbsp;</p>
<h2 id="字符串-Hash"><a href="#字符串-Hash" class="headerlink" title="字符串 Hash"></a>字符串 Hash</h2><ul>
<li><a target="_blank" rel="noopener" href="https://oi-wiki.org/string/hash/">无需多言</a>，get 写法可以记一下。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> ull sy = <span class="number">29</span>; <span class="comment">// system 系统进制</span></span><br><span class="line"><span class="type">char</span> c[N];</span><br><span class="line">ull ans, ha[N], P[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tran</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    P[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        ha[i] = ha[i - <span class="number">1</span>] * sy + c[i] - <span class="string">&#x27;a&#x27;</span> + <span class="number">1</span>, P[i] = P[i - <span class="number">1</span>] * sy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ull <span class="title">get</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;<span class="keyword">return</span> ha[r] - ha[l - <span class="number">1</span>] * P[r - l + <span class="number">1</span>];&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>两个技巧：自然溢出和双哈希。</li>
</ul>
<hr>
<p>&nbsp;</p>
<h2 id="Manacher-算法"><a href="#Manacher-算法" class="headerlink" title="Manacher 算法"></a>Manacher 算法</h2><blockquote>
<p>不想讲了，因为有<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/article/qs0l5ttf">讲的更好的</a></p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> c[N], d[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> n, p[N &lt;&lt; <span class="number">1</span>], ans;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, c + <span class="number">1</span>);</span><br><span class="line">    n = <span class="built_in">strlen</span>(c + <span class="number">1</span>);</span><br><span class="line">    d[<span class="number">0</span>] =  <span class="string">&#x27;~&#x27;</span>, d[<span class="number">1</span>] = <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) d[<span class="number">2</span> * i] = c[i], d[<span class="number">2</span> * i + <span class="number">1</span>] = <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">    n = <span class="number">2</span> * n + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>, mr = <span class="number">0</span>, mid = <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i &gt;= mid &amp;&amp; i &lt;= mr) p[i] = <span class="built_in">min</span>(mr - i + <span class="number">1</span>, p[mid * <span class="number">2</span> - i]);</span><br><span class="line">        <span class="keyword">while</span>(d[i + p[i]] == d[i - p[i]]) p[i]++;</span><br><span class="line">        <span class="keyword">if</span>(i + p[i] &gt; mr) mr = i + p[i] - <span class="number">1</span>, mid = i;</span><br><span class="line">        ans = <span class="built_in">max</span>(ans, p[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, ans - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="倍增"><a href="#倍增" class="headerlink" title="倍增"></a>倍增</h2><blockquote>
<p>想写个“<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/paste/qsoy0f8o"><strong>一题一类·黑</strong></a>”，但是这么重要的算法，还是不敷衍了，<del>毕竟这个我真会</del></p>
</blockquote>
<ul>
<li><p>算法核心很简洁，但论“看见一道题如何想到倍增”：</p>
<ul>
<li><p>最根本性的，是问题（或题目中的操作）具有合并性（可拆分性同理），若有性质，那么就先考虑“最简单的<strong>单步变换（或最简化问题）</strong>”是什么。</p>
</li>
<li><p>其次，要求上述“单步变换（或最简化问题）”有限且好求，要是光一步的变换就有上亿种，那不用考虑倍增了。</p>
</li>
</ul>
<p>Tips：下面都是“操作”相关的倍增。</p>
<ul>
<li><p>在任何阶段，“单步变换”都能直接适用，而非“你的操作受到阶段性的影响”。</p>
</li>
<li><p>最后，你的操作要能够“陷入终点”（在终点后操作仍是终点），否则会无法得到<strong>明确的终止线</strong>。<br>一个正确的例子是（非负）操作代价大于某个数时终止，因为如果代价超了再操作仍然会超。</p>
</li>
</ul>
<p>综上，三点：问题可拆分、操作有限且全局适用、终点后的状态统一，那就可以考虑倍增。</p>
</li>
<li><p>写法细节：</p>
<ul>
<li><p>RMQ：要求子问题可重叠（常用于查询方面的倍增），且查询 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>。</p>
</li>
<li><p>二进制写法：适用性广（常用于操作方面的倍增），但 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>。</p>
</li>
</ul>
</li>
</ul>
<hr>
<p>&nbsp;</p>
<h2 id="整体二分"><a href="#整体二分" class="headerlink" title="整体二分"></a>整体二分</h2><ul>
<li><p>感觉很灵活，但我目前碰到的都比较板：多询问，可离线，单个询问可二分（所以其实算法本质上还是二分答案）。</p>
<p>官方版本：</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/vh57qi6j.png"></p>
</li>
<li><p>带修动态第 k 小，原数组初始化的操作，当作给各个元素赋值的修改操作即可。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m, ans[N], d[N], Q;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Ope</span> &#123;<span class="type">int</span> mode, l, r, k, id;&#125;; <span class="comment">// 1询问 0修改</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">const</span> vector&lt;Ope&gt; &amp; q)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r || q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="keyword">for</span>(Ope i : q) <span class="keyword">if</span>(i.mode) ans[i.id] = l;</span><br><span class="line">        <span class="keyword">return</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    vector&lt;Ope&gt; ql, qr;</span><br><span class="line">    <span class="keyword">for</span>(Ope i : q) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i.mode) &#123;</span><br><span class="line">            <span class="type">int</span> tmp = t.<span class="built_in">query</span>(i.l, i.r);</span><br><span class="line">            <span class="keyword">if</span>(tmp &gt;= i.k) ql.<span class="built_in">push_back</span>(i);</span><br><span class="line">            <span class="keyword">else</span> i.k -= tmp, qr.<span class="built_in">push_back</span>(i);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(i.r &lt;= mid) t.<span class="built_in">modify</span>(i.l, i.k), ql.<span class="built_in">push_back</span>(i);</span><br><span class="line">            <span class="keyword">else</span> qr.<span class="built_in">push_back</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(Ope i : ql) <span class="keyword">if</span>(!i.mode) t.<span class="built_in">modify</span>(i.l, -i.k);</span><br><span class="line">    <span class="built_in">solve</span>(l, mid, ql); ql.<span class="built_in">resize</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">solve</span>(mid + <span class="number">1</span>, r, qr); qr.<span class="built_in">resize</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    t.<span class="built_in">cl</span>(n);</span><br><span class="line">    vector&lt;Ope&gt; q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;d[i]);</span><br><span class="line">        q.<span class="built_in">push_back</span>(&#123;<span class="number">0</span>, i, d[i], <span class="number">1</span>, i&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="type">char</span> mode[<span class="number">5</span>]; <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, mode);</span><br><span class="line">        <span class="keyword">if</span>(mode[<span class="number">0</span>] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">            <span class="type">int</span> a, b, c; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;a, &amp;b, &amp;c);</span><br><span class="line">            q.<span class="built_in">push_back</span>(&#123;<span class="number">1</span>, a, b, c, ++Q&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> a, b; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;a, &amp;b);</span><br><span class="line">            q.<span class="built_in">push_back</span>(&#123;<span class="number">0</span>, a, d[a], <span class="number">-1</span>, i&#125;);</span><br><span class="line">            q.<span class="built_in">push_back</span>(&#123;<span class="number">0</span>, a, b, <span class="number">1</span>, i&#125;);</span><br><span class="line">            d[a] = b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">solve</span>(<span class="number">-1e9</span>, <span class="number">1e9</span>, q);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= Q; i++) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>&nbsp;</p>
<h2 id="CDQ-分治"><a href="#CDQ-分治" class="headerlink" title="CDQ 分治"></a>CDQ 分治</h2><ul>
<li><p>还是旨在<a target="_blank" rel="noopener" href="https://oi-wiki.org/misc/cdq-divide/">思想</a>吧，尤其是“<a target="_blank" rel="noopener" href="https://oi-wiki.org/misc/cdq-divide/#%E5%B0%86%E5%8A%A8%E6%80%81%E9%97%AE%E9%A2%98%E8%BD%AC%E5%8C%96%E4%B8%BA%E9%9D%99%E6%80%81%E9%97%AE%E9%A2%98">动态化静态（通过时间轴）</a>”的分治思想，即不断地在时间轴上左 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span> 右处理贡献。</p>
</li>
<li><p>可以做 1D&#x2F;1D DP 优化：因题而异，分治思想都大差不差。</p>
</li>
<li><p>这点比较好用——<a target="_blank" rel="noopener" href="https://www.tonyyin0418.com/blog/oi-solution/p7529">维护凸包</a>，<del>但我不太会</del>。</p>
</li>
<li><p><a href="https://ewig-milan.github.io/2025/05/15/CDQ%E5%88%86%E6%B2%BB%20%E3%81%AE%20%E6%9D%BF%E5%AD%90%20-%20%E4%B8%89%E7%BB%B4%E5%81%8F%E5%BA%8F/">三位偏序板子</a>。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> a, b, c, cnt, id;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Node &amp; a, <span class="type">const</span> Node &amp; b) &#123;</span><br><span class="line">        <span class="keyword">return</span> a.a == b.a ? (a.b == b.b ? a.c &lt; b.c : a.b &lt; b.b) : a.a &lt; b.a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span> != (<span class="type">const</span> Node &amp; a, <span class="type">const</span> Node &amp; b) &#123;</span><br><span class="line">        <span class="keyword">return</span> a.a != b.a || a.b != b.b || a.c != b.c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; Q[N], tmp[N];</span><br><span class="line"><span class="type">int</span> ans[N], tmp_cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solve</span>(l, mid); <span class="built_in">solve</span>(mid + <span class="number">1</span>, r); <span class="comment">// 按 b 排好了 </span></span><br><span class="line">    <span class="type">int</span> i = l, j = mid + <span class="number">1</span>;</span><br><span class="line">    tmp_cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= mid &amp;&amp; j &lt;= r) &#123;</span><br><span class="line">        <span class="keyword">if</span>(Q[i].b &lt;= Q[j].b) t.<span class="built_in">modify</span>(Q[i].c, Q[i].cnt), tmp[++tmp_cnt] = Q[i++];</span><br><span class="line">        <span class="keyword">else</span> ans[Q[j].id] += t.<span class="built_in">query</span>(Q[j].c), tmp[++tmp_cnt] = Q[j++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= mid) t.<span class="built_in">modify</span>(Q[i].c, Q[i].cnt), tmp[++tmp_cnt] = Q[i++];</span><br><span class="line">    <span class="keyword">while</span>(j &lt;= r) ans[Q[j].id] += t.<span class="built_in">query</span>(Q[j].c), tmp[++tmp_cnt] = Q[j++];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = l; i &lt;= mid; i++) t.<span class="built_in">modify</span>(Q[i].c, -Q[i].cnt);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= tmp_cnt; i++) Q[i + l - <span class="number">1</span>] = tmp[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<hr>
<p>&nbsp;</p>
<h2 id="异或空间线性基"><a href="#异或空间线性基" class="headerlink" title="异或空间线性基"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/article/zo12e4s5">异或空间线性基</a></h2><ul>
<li><p>一个特性：线性基里任一个数可以通过原序列若干数异或得到（神奇）。</p>
</li>
<li><p>这个板子保证线性基里每个数的<strong>最高位</strong>在其它数中都为 0。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, a[N], d[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">basis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">30</span>, t = a[i]; j &gt;= <span class="number">0</span>; j--) <span class="keyword">if</span>((t &gt;&gt; j) &amp; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!d[j]) d[j] = t;</span><br><span class="line">        t ^= d[j];</span><br><span class="line">        <span class="keyword">if</span>(!t) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">30</span>; i++) <span class="keyword">if</span>(d[i])</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; j++)</span><br><span class="line">        <span class="keyword">if</span>((d[i] &gt;&gt; j) &amp; <span class="number">1</span>) d[i] ^= d[j];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>2025.7.11，外培前耗时 5 天完成了本篇文章的第一版，作为一次大复习。然而受限于我的知识面，这样一篇总结性文章肯定是不够全面的，但它也切实的能给我带来“温故而知新”的效果。同时，反复、透彻、加以思考的理解是长久记忆的基础，所以我希望这篇文章能在陪伴我 OI 生涯的同时更加丰富、完善——戛然而止。<br>毕竟是第一版，还不是感慨的时候！</p>
<h6 id="下面是水话"><a href="#下面是水话" class="headerlink" title="下面是水话"></a>下面是水话</h6><p>写完那确实爽了 想整体欣赏一遍！<br>60k 字符量，小目标也是达成了好吧~</p>
<hr>
<p>2026.1.13 突然想写了，又发现最近正好是“Nothing”半年纪念日（<del>大雾</del>）。</p>
<p>半年时光白驹过隙，这半年，发生了许许多多的事情：第一次集训、第一次在 OI 路上结识好兄弟、第一个 CSP-S&#x2F;NOIP 一等、第一次<strong>全自主</strong>学习知识点、与（）交往、第一次（）……当然还有这篇《Nothing》中无数的润色与修改，可以说，它不仅见证了我的成长，更陪伴着我踏出前进的每一步，以扎实的基础知识根基，作为我后期学习的坚固后盾。算是应了当初“<strong>我希望这篇文章能在陪伴我 OI 生涯的同时更加丰富、完善</strong>”的愿景。  </p>
<p>所以，我想说的是：感谢半年前奋斗的我，这份《致未来——Nothing》我们收到了！当然这半年的成长也是不可忽视的，我的内心变得更成熟、更坚强了。其实，也并非万事十全十美，遗憾是常态——CSP-S 的 T2、T3，NOIP 的 T4，偶尔颓废的日子，偶尔低落的日子……但是，瑕不掩瑜嘛，尽力而为，遗憾是“追求完美”，不后悔是“神之自信”！  </p>
<p>那么，同样的，新的一年，我在 2026.1.13，以当下的自己，诚邀未来的自己——继续奋斗！愿未来的我们，共同收到这份礼物！无限攀登——Ewig&#x2F;Ever_crest！</p>
<p>计划 1.25 前完成第二版（<strong>done on Jan.21</strong>）。</p>
<h6 id="我想陪你一起看烟花（“你”是谁呢？）"><a href="#我想陪你一起看烟花（“你”是谁呢？）" class="headerlink" title="我想陪你一起看烟花（“你”是谁呢？）"></a>我想陪你一起看烟花（“你”是谁呢？）</h6></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Ewig-Milan">Ewig-Milan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://ewig-milan.github.io/2025/07/07/Nothing/">https://ewig-milan.github.io/2025/07/07/Nothing/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://ewig-milan.github.io" target="_blank">Blog/博客 [个人]</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/All/">All</a></div><div class="post-share"><div class="social-share" data-image="https://p.sda1.dev/24/5a38ca2b266b9e659804c5758c4d203b/art6.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://p.sda1.dev/24/9cac71e50a28808a469a781a6868ef07/280px-Bad_Cen.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Ewig-Milan</div><div class="author-info-description">向 TUM & MIT 前进</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Ewig-Milan"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Ewig-Milan" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2116813725@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%84%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">附言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%8F%E8%A8%80"><span class="toc-number">2.</span> <span class="toc-text">序言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6"><span class="toc-number">3.</span> <span class="toc-text">数学</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E8%AE%BA"><span class="toc-number">3.1.</span> <span class="toc-text">数论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bases"><span class="toc-number">3.1.1.</span> <span class="toc-text">Bases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E7%AD%9B"><span class="toc-number">3.1.2.</span> <span class="toc-text">线性筛</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%86%E5%85%83-EXGCD"><span class="toc-number">3.1.3.</span> <span class="toc-text">逆元 &amp; EXGCD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.4.</span> <span class="toc-text">欧拉函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%88%E6%95%B4%E9%99%A4%EF%BC%89%E6%95%B0%E8%AE%BA%E5%88%86%E5%9D%97"><span class="toc-number">3.1.5.</span> <span class="toc-text">（整除）数论分块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRT-EXCRT"><span class="toc-number">3.1.6.</span> <span class="toc-text">CRT &amp; EXCRT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%8F%8D%E6%BC%94"><span class="toc-number">3.1.7.</span> <span class="toc-text">莫比乌斯反演</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AC%A7%E6%8B%89%E5%8F%8D%E6%BC%94"><span class="toc-number">3.1.8.</span> <span class="toc-text">欧拉反演</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6"><span class="toc-number">3.2.</span> <span class="toc-text">组合数学</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bases-1"><span class="toc-number">3.2.1.</span> <span class="toc-text">Bases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E6%96%A5%E5%8E%9F%E7%90%86"><span class="toc-number">3.2.2.</span> <span class="toc-text">容斥原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%AE%9A%E7%90%86"><span class="toc-number">3.2.3.</span> <span class="toc-text">二项式定理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lucas-%E5%AE%9A%E7%90%86"><span class="toc-number">3.2.4.</span> <span class="toc-text">Lucas 定理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exLucas-%E7%AE%97%E6%B3%95"><span class="toc-number">3.2.5.</span> <span class="toc-text">exLucas 算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%A1%E7%89%B9%E5%85%B0%E6%95%B0"><span class="toc-number">3.2.6.</span> <span class="toc-text">卡特兰数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E7%8E%87%E8%AE%BA"><span class="toc-number">3.3.</span> <span class="toc-text">概率论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bases-2"><span class="toc-number">3.3.1.</span> <span class="toc-text">Bases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E6%A6%82%E7%8E%87-%E6%9C%9F%E6%9C%9B-DP"><span class="toc-number">3.3.2.</span> <span class="toc-text">关于概率&#x2F;期望 DP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83"><span class="toc-number">3.3.3.</span> <span class="toc-text">高斯消元</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.</span> <span class="toc-text">数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.1.</span> <span class="toc-text">基础数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#STL-%E5%89%8D%E7%BC%80%E5%92%8C-%E5%B7%AE%E5%88%86"><span class="toc-number">4.1.1.</span> <span class="toc-text">STL &amp; 前缀和 &amp; 差分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97"><span class="toc-number">4.1.2.</span> <span class="toc-text">单调队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="toc-number">4.1.3.</span> <span class="toc-text">并查集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%9D%97"><span class="toc-number">4.1.4.</span> <span class="toc-text">分块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84"><span class="toc-number">4.1.5.</span> <span class="toc-text">树状数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="toc-number">4.1.6.</span> <span class="toc-text">线段树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trie%E6%A0%91"><span class="toc-number">4.1.7.</span> <span class="toc-text">Trie树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B3%E8%A1%A1%E6%A0%91"><span class="toc-number">4.1.8.</span> <span class="toc-text">平衡树</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.</span> <span class="toc-text">可持久化数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="toc-number">4.2.1.</span> <span class="toc-text">可持久化并查集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="toc-number">4.2.2.</span> <span class="toc-text">可持久化线段树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96-Trie-%E6%A0%91"><span class="toc-number">4.2.3.</span> <span class="toc-text">可持久化 Trie 树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96-FHQ-Treap"><span class="toc-number">4.2.4.</span> <span class="toc-text">可持久化 FHQ-Treap</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.3.</span> <span class="toc-text">进阶数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8"><span class="toc-number">4.3.1.</span> <span class="toc-text">哈希表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%B8%AD%E6%A0%91"><span class="toc-number">4.3.2.</span> <span class="toc-text">主席树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%8E%E8%B6%85%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="toc-number">4.3.3.</span> <span class="toc-text">李超线段树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E5%8F%B7%E5%88%86%E6%B2%BB%EF%BC%88%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%98%AF%E6%80%9D%E6%83%B3%E5%B1%82%E9%9D%A2%EF%BC%89"><span class="toc-number">4.3.4.</span> <span class="toc-text">根号分治（更多的是思想层面）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%AB%E9%98%9F"><span class="toc-number">4.3.5.</span> <span class="toc-text">莫队</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E8%AE%BA"><span class="toc-number">5.</span> <span class="toc-text">图论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%91"><span class="toc-number">5.1.</span> <span class="toc-text">树</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bases-3"><span class="toc-number">5.1.1.</span> <span class="toc-text">Bases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86"><span class="toc-number">5.1.2.</span> <span class="toc-text">树链剖分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%88%86%E6%B2%BB"><span class="toc-number">5.1.3.</span> <span class="toc-text">点分治</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DSU-on-Tree%EF%BC%88%E5%90%AF%E5%8F%91%E5%BC%8F%E7%AE%97%E6%B3%95%EF%BC%89"><span class="toc-number">5.1.4.</span> <span class="toc-text">DSU on Tree（启发式算法）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%91%E5%88%86%E5%9D%97"><span class="toc-number">5.1.5.</span> <span class="toc-text">树分块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE"><span class="toc-number">5.2.</span> <span class="toc-text">图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bases-4"><span class="toc-number">5.2.1.</span> <span class="toc-text">Bases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%9F%AD%E8%B7%AF"><span class="toc-number">5.2.2.</span> <span class="toc-text">最短路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%BA%E8%BF%9E%E9%80%9A"><span class="toc-number">5.2.3.</span> <span class="toc-text">强连通</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E8%BF%9E%E9%80%9A"><span class="toc-number">5.2.4.</span> <span class="toc-text">双连通</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#K-%E7%9F%AD%E8%B7%AF"><span class="toc-number">5.2.5.</span> <span class="toc-text">K 短路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F"><span class="toc-number">5.2.6.</span> <span class="toc-text">差分约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%8E%AF%E6%A0%91"><span class="toc-number">5.2.7.</span> <span class="toc-text">基环树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91"><span class="toc-number">5.2.8.</span> <span class="toc-text">最小生成树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AC%A7%E6%8B%89%EF%BC%88%E5%9B%9E%EF%BC%89%E8%B7%AF"><span class="toc-number">5.2.9.</span> <span class="toc-text">欧拉（回）路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%88%86%E5%9B%BE"><span class="toc-number">5.2.10.</span> <span class="toc-text">二分图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%B5%81"><span class="toc-number">5.3.</span> <span class="toc-text">网络流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bases-5"><span class="toc-number">5.3.1.</span> <span class="toc-text">Bases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%A4%A7%E6%B5%81"><span class="toc-number">5.3.2.</span> <span class="toc-text">最大流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%B9%E7%94%A8%E6%B5%81"><span class="toc-number">5.3.3.</span> <span class="toc-text">费用流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B8%E4%BE%8B"><span class="toc-number">5.3.4.</span> <span class="toc-text">典例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92"><span class="toc-number">6.</span> <span class="toc-text">动态规划</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DP-%E9%83%A8%E5%88%86"><span class="toc-number">6.1.</span> <span class="toc-text">DP 部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bases-6"><span class="toc-number">6.1.1.</span> <span class="toc-text">Bases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E9%A2%98%E4%B8%80%E7%B1%BB"><span class="toc-number">6.1.2.</span> <span class="toc-text">一题一类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98"><span class="toc-number">6.1.3.</span> <span class="toc-text">背包问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E9%83%A8%E5%88%86"><span class="toc-number">6.2.</span> <span class="toc-text">优化部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B0%E5%BF%86%E5%8C%96%E6%90%9C%E7%B4%A2"><span class="toc-number">6.2.1.</span> <span class="toc-text">记忆化搜索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8F%91%E5%BC%8F%E4%BC%98%E5%8C%96"><span class="toc-number">6.2.2.</span> <span class="toc-text">启发式优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97%E4%BC%98%E5%8C%96"><span class="toc-number">6.2.3.</span> <span class="toc-text">单调队列优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E8%BE%B9%E5%BD%A2%E4%B8%8D%E7%AD%89%E5%BC%8F%E4%BC%98%E5%8C%96"><span class="toc-number">6.2.4.</span> <span class="toc-text">四边形不等式优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96"><span class="toc-number">6.2.5.</span> <span class="toc-text">斜率优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A9%E9%98%B5%E4%B9%98%E6%96%B9%E4%BC%98%E5%8C%96%EF%BC%88%E5%8A%A0%E9%80%9F%E9%80%92%E6%8E%A8%EF%BC%89"><span class="toc-number">6.2.6.</span> <span class="toc-text">矩阵乘方优化（加速递推）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">7.</span> <span class="toc-text">字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84"><span class="toc-number">7.1.</span> <span class="toc-text">后缀数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KMP"><span class="toc-number">7.2.</span> <span class="toc-text">KMP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AC-%E8%87%AA%E5%8A%A8%E6%9C%BA"><span class="toc-number">7.3.</span> <span class="toc-text">AC 自动机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2-Hash"><span class="toc-number">7.4.</span> <span class="toc-text">字符串 Hash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Manacher-%E7%AE%97%E6%B3%95"><span class="toc-number">7.5.</span> <span class="toc-text">Manacher 算法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%82%E9%A1%B9"><span class="toc-number">8.</span> <span class="toc-text">杂项</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%80%8D%E5%A2%9E"><span class="toc-number">8.1.</span> <span class="toc-text">倍增</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E4%BA%8C%E5%88%86"><span class="toc-number">8.2.</span> <span class="toc-text">整体二分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CDQ-%E5%88%86%E6%B2%BB"><span class="toc-number">8.3.</span> <span class="toc-text">CDQ 分治</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%88%96%E7%A9%BA%E9%97%B4%E7%BA%BF%E6%80%A7%E5%9F%BA"><span class="toc-number">8.4.</span> <span class="toc-text">异或空间线性基</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-number">9.</span> <span class="toc-text">后记</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8B%E9%9D%A2%E6%98%AF%E6%B0%B4%E8%AF%9D"><span class="toc-number">9.0.0.0.0.1.</span> <span class="toc-text">下面是水话</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%88%91%E6%83%B3%E9%99%AA%E4%BD%A0%E4%B8%80%E8%B5%B7%E7%9C%8B%E7%83%9F%E8%8A%B1%EF%BC%88%E2%80%9C%E4%BD%A0%E2%80%9D%E6%98%AF%E8%B0%81%E5%91%A2%EF%BC%9F%EF%BC%89"><span class="toc-number">9.0.0.0.0.2.</span> <span class="toc-text">我想陪你一起看烟花（“你”是谁呢？）</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/07/FHQ-Treap/" title="FHQ-Treap 从入门到入门"><img src="https://p.sda1.dev/24/0addcdded57cdc719d8fdfea25c46710/art3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="FHQ-Treap 从入门到入门"/></a><div class="content"><a class="title" href="/2026/01/07/FHQ-Treap/" title="FHQ-Treap 从入门到入门">FHQ-Treap 从入门到入门</a><time datetime="2026-01-06T16:00:00.000Z" title="发表于 2026-01-07 00:00:00">2026-01-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/07/Nothing/" title="Nothing"><img src="https://p.sda1.dev/24/5a38ca2b266b9e659804c5758c4d203b/art6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nothing"/></a><div class="content"><a class="title" href="/2025/07/07/Nothing/" title="Nothing">Nothing</a><time datetime="2025-07-06T16:00:00.000Z" title="发表于 2025-07-07 00:00:00">2025-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/13/%E6%8F%92%E5%A4%B4DP%20-%20%E5%93%88%E5%AF%86%E9%A1%BF%E5%9B%9E%E8%B7%AF%E8%AE%A1%E6%95%B0/" title="插头DP - 哈密顿回路计数"><img src="https://p.sda1.dev/24/929415843498271df368b2e00c610b36/art1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="插头DP - 哈密顿回路计数"/></a><div class="content"><a class="title" href="/2025/06/13/%E6%8F%92%E5%A4%B4DP%20-%20%E5%93%88%E5%AF%86%E9%A1%BF%E5%9B%9E%E8%B7%AF%E8%AE%A1%E6%95%B0/" title="插头DP - 哈密顿回路计数">插头DP - 哈密顿回路计数</a><time datetime="2025-06-12T16:00:00.000Z" title="发表于 2025-06-13 00:00:00">2025-06-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://p.sda1.dev/24/5a38ca2b266b9e659804c5758c4d203b/art6.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By Ewig-Milan</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css')
    if (false) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script></div><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.js" integrity="sha384-4z8mjH4yIpuK9dIQGR1JwbrfYsStrNK6MP+2Enhue4eyo0XlBDXOIPc8b6ZU0ajz" crossorigin="anonymous"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>